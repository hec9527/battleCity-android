var ht=Object.defineProperty;var lt=(n,t,e)=>t in n?ht(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var i=(n,t,e)=>(lt(n,typeof t!="symbol"?t+"":t,e),e);import{r as c,C as o,E as s,a as m,i as S,g as j}from"./index-CGI5Z131.js";class B{constructor(t="P1"){i(this,"life",3);i(this,"score",0);i(this,"tank",null);i(this,"roleType");i(this,"awardLife",0);i(this,"killRecord",{});this.roleType=t,this.resetKillRecord()}resetKillRecord(){this.killRecord={0:0,1:0,2:0,3:0}}getTotalKill(){return[0,1,2,3].reduce((t,e)=>this.killRecord[e]+t,0)}setKillRecord(t){this.killRecord[t]=this.killRecord[t]+1,this.addScore((t+1)*100)}getKillRecord(){return this.killRecord}getRoleType(){return this.roleType}addScore(t){this.score+=t,Math.floor(this.score/2e4)>this.awardLife&&(this.addLife(),this.awardLife++)}getScore(){return this.score}getTank(){return this.tank}setTank(t){this.tank=t}getLife(){return this.life}reduceLife(){this.life--}addLife(){this.life++,c.Audio.play("life")}}class ct{constructor(){i(this,"mode","single");i(this,"gameOver",!1);i(this,"stage",1);i(this,"players",[])}getGameOver(){return this.gameOver}setGameOver(t){this.gameOver=t}getMode(){return this.mode}setMode(t){this.mode=t,this.players=[new B("P1")],t==="double"&&this.players.push(new B("P2"))}getPlayers(){return this.players}getStage(){return this.stage}getLoopStage(){return this.stage%35+1}setStage(t){this.stage=t}nextStage(){this.stage++,this.stage>o.game.maxStage&&(this.stage=o.game.maxStage)}}class p{constructor(t,e){i(this,"finished",!1);i(this,"tick",0);i(this,"tickOut");i(this,"callback");this.tickOut=t,this.callback=e}update(){var t;this.finished||++this.tick>=this.tickOut&&((t=this.callback)==null||t.call(this),this.finished=!0)}isFinished(){return this.finished}}const W=[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,18,4,17,0,0,0,0,0],[0,0,0,0,0,3,15,5,0,0,0,0,0]],dt=[[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,0,1,0,1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1,0,1,0,1,0],[0,1,0,1,0,1,6,1,0,1,0,1,0],[0,1,0,1,0,2,0,2,0,1,0,1,0],[0,2,0,2,0,4,0,4,0,2,0,2,0],[4,0,4,4,0,2,0,2,0,4,4,0,4],[7,0,2,2,0,4,0,4,0,2,2,0,7],[0,4,0,4,0,1,1,1,0,4,0,4,0],[0,1,0,1,0,1,0,1,0,1,0,1,0],[0,1,0,1,0,2,0,2,0,1,0,1,0],[0,1,0,1,0,18,4,17,0,1,0,1,0],[0,0,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,6,0,0,0,6,0,0,0,0,0],[0,1,0,6,0,0,0,1,0,1,0,1,0],[0,1,0,0,0,0,1,1,0,1,6,1,0],[0,0,0,1,0,0,0,0,0,6,0,0,0],[11,0,0,1,0,0,6,0,0,1,11,1,6],[11,11,0,0,0,1,0,0,6,0,11,0,0],[0,1,1,1,11,11,11,6,0,0,11,1,0],[0,0,0,6,11,1,0,1,0,1,0,1,0],[6,1,0,6,0,1,0,1,0,1,6,1,0],[0,1,0,1,0,1,1,1,0,1,6,1,0],[0,1,0,1,0,1,1,1,0,0,0,0,0],[0,1,0,0,0,18,4,17,0,1,0,1,0],[0,1,0,1,0,3,15,5,0,1,1,1,0]],[[0,0,0,0,1,0,0,1,0,0,0,0,0],[0,11,11,11,1,0,0,0,0,0,9,9,9],[1,11,11,11,0,0,0,0,0,0,0,0,0],[11,11,11,11,0,0,0,1,0,1,1,1,5],[11,11,11,11,1,1,1,2,0,1,0,3,0],[11,11,11,11,0,0,1,0,0,0,0,3,0],[0,11,0,0,0,0,6,6,6,0,0,11,0],[0,4,0,4,0,0,0,0,0,11,11,11,11],[1,5,3,1,5,3,2,2,2,11,11,11,11],[0,0,0,0,0,1,0,4,4,11,11,11,11],[1,0,0,10,0,0,0,2,2,11,11,11,0],[1,1,0,10,0,18,4,17,0,11,11,11,0],[6,1,1,0,0,3,15,5,0,1,0,0,0]],[[0,11,11,0,0,0,0,0,0,0,0,11,0],[11,11,0,0,4,1,1,4,4,0,0,0,11],[11,0,0,3,1,1,1,1,1,1,4,0,7],[7,0,0,1,1,1,1,1,1,1,1,5,0],[0,0,3,2,0,0,0,2,1,1,0,5,0],[13,0,3,0,10,0,10,0,1,5,0,0,0],[0,0,1,0,4,4,0,0,1,5,0,13,13],[0,0,1,1,1,1,1,1,1,1,0,0,0],[0,3,1,1,1,1,1,1,1,1,5,0,0],[0,2,2,1,1,1,1,1,1,2,2,0,0],[0,1,1,4,2,1,1,2,4,1,1,0,11],[11,0,2,2,0,18,4,17,2,2,0,11,11],[6,11,0,0,0,3,15,5,0,0,11,11,6]],[[0,0,0,0,1,1,0,0,0,0,0,0,0],[9,0,4,0,1,0,0,0,7,7,6,0,0],[6,0,1,0,0,0,1,0,0,0,0,0,0],[1,0,1,1,1,0,1,1,0,13,13,0,13],[2,0,0,0,2,0,0,0,0,13,0,0,0],[0,0,4,0,13,13,0,13,13,13,0,1,1],[1,1,0,0,13,1,0,1,5,0,0,0,0],[0,0,0,0,13,0,0,0,0,0,8,10,0],[13,13,13,0,13,0,6,0,1,0,8,0,0],[0,0,0,4,4,0,0,0,0,0,8,1,1],[0,0,0,0,1,2,2,2,1,4,0,0,0],[1,1,2,0,0,18,4,17,0,2,1,0,0],[2,0,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,0,0,3,0,5,11,11,0,0,0],[0,5,8,0,5,0,0,0,3,11,5,3,11],[0,5,8,0,5,0,1,0,3,11,5,3,11],[0,1,0,0,1,0,6,0,1,11,0,1,11],[0,0,0,3,7,0,1,0,2,10,0,11,11],[1,1,5,0,0,11,1,11,0,0,3,1,1],[0,0,0,0,3,11,11,11,5,0,0,0,0],[6,1,1,0,2,11,11,11,2,3,1,1,6],[7,7,7,0,4,0,11,0,4,0,7,7,7],[0,1,0,0,1,0,0,0,1,0,0,0,0],[0,1,5,0,0,2,0,2,0,0,0,0,11],[0,0,2,0,0,18,4,17,0,0,11,11,11],[0,0,4,0,0,3,15,5,0,0,4,11,11]],[[0,0,0,0,0,0,0,7,7,0,0,0,0],[0,0,6,7,7,7,0,0,0,0,6,0,0],[0,0,6,0,0,0,11,0,7,6,6,0,0],[0,6,0,0,0,11,6,0,0,0,6,0,0],[0,0,0,0,11,6,6,0,0,0,7,6,0],[0,6,0,11,6,6,6,0,6,0,0,0,0],[0,8,0,6,6,0,0,0,6,6,0,0,0],[10,0,0,0,6,0,6,6,6,0,0,8,0],[0,8,6,0,0,0,6,6,11,0,0,6,0],[0,6,0,0,0,0,6,11,0,0,6,6,0],[0,7,7,6,0,0,11,0,0,6,0,0,0],[0,0,0,0,0,18,4,17,0,7,0,9,6],[9,9,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,1,0,0,1,0,4,0,1,0,0,0],[11,1,1,1,0,1,0,9,0,1,5,0,0],[11,11,11,0,0,2,0,1,0,2,0,3,5],[11,13,13,13,13,13,13,13,13,13,13,0,13],[0,1,0,0,0,0,4,4,0,0,0,0,0],[0,0,1,0,0,3,1,1,2,1,2,7,7],[1,1,0,1,0,3,1,1,11,1,9,9,1],[0,0,0,6,0,9,0,11,11,11,11,0,0],[13,13,0,13,13,13,13,13,0,13,13,13,13],[11,11,0,3,0,0,4,4,0,0,0,0,0],[11,11,1,0,3,0,0,3,0,9,4,1,0],[11,9,1,0,3,18,4,17,0,2,0,1,0],[0,0,0,0,0,3,15,5,0,4,0,2,0]],[[0,0,0,1,0,0,0,0,0,9,11,0,0],[1,0,0,0,0,0,9,11,8,6,10,0,1],[0,0,0,9,11,8,6,10,0,7,0,0,0],[0,0,8,6,10,0,7,0,0,0,0,0,0],[0,0,0,7,11,0,0,0,0,0,0,0,0],[0,0,0,11,9,11,0,11,9,11,0,0,0],[6,1,0,8,6,10,0,8,6,10,0,1,6],[0,0,0,11,7,11,0,11,7,11,0,0,0],[0,0,0,0,9,0,0,0,9,0,0,0,0],[1,0,0,8,6,10,0,8,6,10,0,0,1],[1,0,0,11,7,11,0,11,7,11,0,0,1],[0,0,4,0,0,18,4,17,0,0,4,0,0],[0,0,1,1,0,3,15,5,0,1,1,0,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,3,2,1,0,0,0,0,0,0,1,2,5],[3,2,0,0,1,0,11,11,0,1,0,0,3],[1,0,0,0,1,11,11,11,11,1,0,0,3],[1,0,0,3,1,11,6,6,11,1,5,0,1],[3,4,4,1,13,13,13,13,13,13,1,1,1],[0,1,1,1,6,6,1,6,6,1,1,1,5],[0,0,1,1,6,0,1,0,6,1,1,5,0],[0,0,1,1,1,1,1,1,1,1,1,5,0],[1,11,2,2,2,6,6,2,2,2,2,11,1],[1,11,11,11,11,11,11,11,11,11,11,11,1],[0,0,11,11,11,18,4,17,11,11,11,11,0],[0,0,0,5,0,3,15,5,0,0,5,0,0]],[[0,0,0,0,0,6,0,1,0,1,1,0,0],[0,3,1,1,1,1,0,1,0,0,0,0,0],[0,0,0,5,0,1,0,1,1,0,11,11,11],[0,3,0,0,0,0,0,6,0,11,11,11,11],[0,3,0,1,1,1,6,1,1,11,11,2,6],[0,2,2,2,6,0,0,1,0,11,11,0,3],[3,1,1,1,0,6,11,11,11,11,11,0,0],[0,0,0,6,0,0,11,11,11,11,11,1,0],[6,1,0,11,11,11,11,6,11,11,11,1,0],[3,1,11,11,11,11,11,0,0,0,0,1,5],[0,1,11,11,0,0,0,0,7,1,1,1,0],[0,0,11,11,0,18,4,17,0,1,0,3,0],[0,4,11,11,0,3,15,5,0,0,0,0,0]],[[0,0,0,0,0,0,0,1,1,1,0,0,0],[0,1,1,1,4,0,4,0,0,1,0,0,0],[0,0,0,0,1,0,2,0,0,0,0,1,1],[0,13,13,13,13,13,0,1,5,0,0,1,7],[0,0,9,9,9,13,0,1,0,6,10,1,0],[1,0,1,1,1,13,13,13,0,13,1,1,0],[0,0,0,0,6,13,0,0,0,13,7,0,0],[13,13,13,0,13,13,1,1,0,13,0,0,0],[0,0,0,0,0,1,7,7,0,13,13,13,0],[1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,7,7,0,0,0,1,1,0,3],[1,0,0,0,0,18,4,17,0,1,0,0,1],[0,0,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,0,4,0,0,0,4,0,0,0,0],[0,1,1,1,1,0,0,0,1,1,1,1,0],[0,1,0,0,0,0,1,0,0,0,0,6,0],[0,6,0,1,2,0,0,0,2,1,0,1,1],[0,1,0,5,11,9,6,9,11,3,0,6,1],[0,2,0,0,11,11,11,11,11,0,0,7,1],[1,9,0,0,11,11,11,11,11,0,0,4,1],[1,6,0,5,11,7,6,7,11,3,0,1,0],[1,1,0,1,4,0,0,0,4,1,0,6,0],[1,6,0,0,0,0,1,0,0,0,0,1,0],[1,1,1,1,1,0,0,0,1,1,1,6,6],[1,1,0,0,2,18,4,17,2,0,0,1,0],[1,1,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[11,11,0,0,4,1,1,1,4,0,0,11,11],[11,0,0,3,1,1,1,1,1,5,0,0,11],[0,0,0,1,1,11,1,11,1,1,0,0,0],[0,0,0,1,11,11,1,11,11,1,0,0,0],[11,0,0,1,1,1,1,1,1,1,0,0,11],[11,11,0,0,1,11,1,11,1,0,0,11,11],[13,13,13,0,1,1,1,1,1,0,13,13,13],[0,0,0,0,3,3,3,3,3,0,0,0,0],[0,0,0,0,5,5,5,5,5,0,0,0,0],[8,8,8,0,0,0,0,0,0,0,10,10,10],[5,5,5,0,0,18,4,17,0,0,3,3,3],[10,10,10,8,0,3,15,5,0,10,8,8,8]],[[0,0,0,0,1,1,0,0,1,0,0,0,0],[0,11,11,1,1,0,0,0,1,0,0,0,0],[11,11,11,11,11,11,11,11,1,1,0,0,0],[11,7,1,11,1,1,1,11,11,11,11,1,6],[11,11,1,11,11,11,7,11,11,1,10,1,0],[0,11,11,1,9,11,11,11,11,1,0,1,0],[0,1,1,1,1,1,11,11,1,1,5,11,11],[8,7,1,1,11,0,0,1,2,0,0,0,11],[0,1,0,1,11,9,4,2,11,11,1,5,11],[0,1,0,0,3,1,2,11,11,1,0,0,11],[0,1,1,5,3,2,11,11,4,11,1,11,11],[0,0,1,0,11,18,4,17,1,11,2,11,0],[0,0,2,0,0,3,15,5,0,11,11,11,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,11,6,0,0,0,0,0,0,0,0],[0,0,0,11,0,11,9,0,0,0,0,0,0],[0,11,0,0,0,0,11,4,0,0,0,0,0],[0,11,11,0,0,11,0,11,9,0,0,0,0],[0,11,0,11,0,11,0,0,11,4,0,0,0],[0,11,0,0,11,0,0,0,11,11,9,0,0],[0,0,11,0,0,0,0,11,11,11,11,4,0],[0,0,0,11,0,0,11,0,11,11,11,11,0],[1,0,0,0,0,0,11,0,0,11,11,11,6],[1,1,0,0,0,0,0,11,0,11,11,11,11],[6,1,1,0,0,18,4,17,11,0,11,11,11],[6,6,1,1,0,3,15,5,11,0,0,11,11]],[[0,0,0,0,4,0,0,0,0,0,4,0,0],[0,1,0,1,1,0,0,12,12,12,1,1,0],[0,1,0,0,1,0,6,12,12,12,12,12,0],[12,12,12,10,1,0,0,1,12,12,12,12,0],[12,12,12,12,12,12,1,1,3,5,0,0,0],[0,0,8,12,12,12,12,1,3,5,0,7,7],[1,1,1,1,12,12,12,12,12,12,12,1,1],[0,0,0,1,1,12,12,12,12,10,0,0,0],[0,1,1,1,0,12,12,12,1,1,0,1,0],[12,12,12,1,12,0,0,0,0,1,0,1,0],[12,12,12,12,12,7,0,7,0,0,4,1,0],[1,12,12,12,12,18,4,17,0,1,0,0,0],[1,1,10,0,0,3,15,5,0,1,0,1,0]],[[0,0,0,0,0,0,0,0,6,6,6,11,0],[0,1,0,0,0,0,0,0,6,0,0,6,0],[1,11,1,0,0,0,1,1,1,1,0,6,0],[0,1,11,1,0,0,1,0,11,1,6,6,0],[0,0,1,0,11,6,1,11,0,1,0,0,0],[0,0,0,0,6,0,1,6,1,1,0,0,0],[0,0,1,1,6,1,0,6,0,0,0,0,0],[0,0,1,0,11,1,6,11,0,0,0,0,0],[6,6,6,11,0,1,0,0,1,1,0,0,0],[6,0,1,1,1,1,0,0,1,6,6,0,0],[6,0,0,6,0,0,0,0,0,6,1,1,0],[11,6,6,6,0,18,4,17,0,0,1,6,6],[0,0,0,0,0,3,15,5,0,0,0,6,6]],[[0,1,0,1,0,1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1,0,1,0,1,0],[0,7,0,7,0,7,0,7,0,7,0,7,0],[4,0,4,0,1,0,0,0,1,0,4,0,4],[1,0,1,2,1,0,1,0,1,2,1,0,1],[7,0,7,0,6,0,7,0,6,0,7,0,7],[11,11,0,0,1,0,11,0,1,0,0,11,11],[11,11,11,11,1,2,11,2,1,11,11,11,11],[11,11,11,11,11,11,11,11,11,11,11,11,11],[4,0,4,0,1,11,11,11,1,0,4,0,4],[0,1,0,1,0,0,11,0,0,1,0,1,0],[0,1,0,1,0,18,4,17,0,1,0,1,0],[0,2,0,2,0,3,15,5,0,2,0,2,0]],[[0,0,0,13,0,1,0,0,1,0,1,0,0],[0,0,0,0,0,0,0,0,1,0,6,0,0],[0,0,0,13,0,4,6,0,1,0,1,0,0],[7,0,1,13,0,6,0,4,2,0,1,0,0],[0,0,1,13,0,0,0,1,0,0,0,0,0],[1,0,1,13,13,0,13,13,13,13,0,0,1],[0,0,0,4,0,0,0,11,0,13,0,7,7],[1,1,3,1,0,6,11,11,11,13,0,4,4],[2,0,3,0,0,1,11,11,11,13,0,1,0],[0,9,0,0,0,1,0,11,0,13,0,11,0],[0,1,0,9,0,2,2,2,0,0,11,11,11],[0,1,0,1,0,18,4,17,0,13,11,11,11],[0,0,0,0,0,3,15,5,0,13,0,11,0]],[[0,0,0,4,4,4,0,0,4,0,0,0,0],[0,4,1,1,1,1,1,1,1,1,0,0,0],[0,11,11,11,11,11,11,11,11,1,1,0,0],[11,11,0,0,0,0,0,0,11,11,1,1,0],[11,0,6,0,0,6,0,0,0,11,11,11,0],[11,0,6,0,0,6,0,0,0,11,11,11,0],[11,0,0,11,0,0,0,0,11,11,1,1,5],[11,11,11,11,11,11,11,11,11,1,1,1,5],[1,11,11,1,1,11,11,11,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,0,6],[6,0,1,6,1,1,1,1,1,1,5,0,6],[0,6,1,2,6,18,4,17,1,1,6,6,6],[0,0,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,0,0,11,0,0,0,0,0,0,0],[0,0,0,0,11,6,11,0,0,0,0,0,0],[0,0,11,0,0,11,0,0,11,11,0,0,0],[0,11,1,11,0,0,0,11,1,1,11,0,0],[0,0,11,1,11,0,0,0,11,11,0,0,11],[11,0,0,11,0,0,11,0,0,0,0,11,6],[1,11,0,0,0,11,6,11,0,0,11,0,11],[6,1,11,0,0,0,11,0,0,11,6,11,0],[1,11,0,0,11,0,0,0,11,0,11,0,0],[11,0,0,11,1,11,0,11,1,11,0,0,0],[0,0,0,11,1,11,0,0,11,0,0,11,0],[0,11,0,0,11,18,4,17,0,0,11,6,11],[11,6,11,0,0,3,15,5,0,11,1,11,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,6,6,0,0,0,0,0,0],[0,0,0,0,0,0,6,0,0,0,0,0,0],[0,6,6,11,11,1,6,1,11,11,6,6,0],[0,0,0,6,11,11,6,11,11,6,0,0,0],[11,0,0,0,6,11,11,11,6,0,0,0,11],[6,11,0,0,0,11,11,11,0,0,0,11,6],[11,0,0,0,9,7,11,7,9,0,0,0,11],[0,0,0,0,6,0,9,0,6,0,0,0,0],[0,0,0,6,0,0,6,0,0,6,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,18,4,17,0,0,0,0,0],[0,0,6,0,0,3,15,5,0,0,6,0,0]],[[0,0,6,0,1,7,0,0,0,0,3,0,0],[0,0,1,0,1,11,0,2,1,1,1,0,0],[0,11,11,0,1,11,3,5,0,0,0,6,6],[11,11,11,11,11,11,1,1,1,0,3,1,0],[0,0,11,11,4,4,7,1,0,3,1,2,3],[1,7,0,4,2,2,0,0,0,1,2,0,3],[3,0,4,1,12,12,12,12,12,12,12,12,12],[3,0,2,0,12,12,12,12,12,12,12,12,12],[0,0,6,0,12,12,12,12,12,12,12,12,12],[1,0,1,0,12,12,12,12,12,12,12,12,12],[3,0,1,0,12,12,12,12,12,12,12,12,12],[3,0,1,0,0,18,4,17,12,12,12,12,12],[0,0,2,0,0,3,15,5,0,12,12,12,12]],[[0,0,0,6,0,1,0,1,0,1,0,6,0],[0,1,0,1,0,0,0,0,0,6,0,0,0],[0,1,0,1,0,0,6,0,0,6,0,6,6],[0,1,0,0,0,1,0,6,1,0,0,0,6],[0,0,0,0,1,1,0,1,1,0,6,0,0],[0,0,6,0,1,0,0,1,1,0,1,1,0],[6,0,6,0,0,1,0,6,0,0,6,1,0],[0,0,1,1,0,1,0,0,0,1,6,0,0],[0,6,1,1,0,1,1,0,1,1,0,0,1],[0,1,0,0,0,1,6,0,0,0,0,1,1],[0,0,0,1,0,1,1,6,0,6,0,0,1],[1,0,1,1,0,18,4,17,0,1,6,0,0],[1,0,1,0,0,3,15,5,0,1,1,1,0]],[[0,0,13,13,0,0,0,0,0,0,0,0,0],[9,0,0,13,11,0,5,0,0,0,0,0,0],[11,9,0,0,0,0,10,0,5,0,13,13,0],[11,11,0,7,4,3,0,0,10,11,13,0,0],[11,11,11,0,0,6,4,3,0,0,0,0,9],[11,11,7,9,0,3,0,6,4,0,0,9,11],[11,7,0,0,2,6,0,3,0,7,0,11,11],[0,0,0,0,0,5,2,6,0,0,11,11,11],[0,0,13,11,8,0,0,5,2,9,7,11,11],[0,13,13,0,3,0,8,0,0,0,0,0,11],[0,0,0,0,0,0,3,0,11,13,0,0,7],[6,0,0,0,0,18,4,17,0,13,13,0,0],[0,0,0,0,0,3,15,5,0,0,0,0,6]],[[0,0,0,0,6,0,0,0,0,0,0,0,0],[6,6,0,0,6,0,0,6,6,0,0,0,0],[0,6,0,0,6,0,0,0,6,0,6,6,11],[0,6,0,0,6,6,6,0,11,0,6,0,0],[0,1,0,0,0,0,6,0,6,6,6,0,0],[11,6,6,0,6,1,6,1,1,0,0,0,0],[0,0,6,11,6,11,0,0,1,0,0,6,6],[0,0,6,0,0,11,0,0,6,0,0,6,0],[0,0,1,0,0,6,0,0,6,6,1,6,0],[11,6,6,6,11,11,1,6,6,0,1,6,0],[0,0,0,1,0,0,0,0,11,11,0,1,0],[0,0,0,6,0,18,4,17,0,11,0,1,0],[0,0,0,6,0,3,15,5,0,6,0,1,0]],[[0,0,0,0,0,0,0,0,0,0,8,10,0],[0,0,0,0,0,0,9,0,0,0,6,0,0],[0,0,0,0,0,4,11,4,0,1,5,0,0],[0,0,0,0,9,11,11,11,9,1,5,0,0],[0,0,0,4,11,11,12,11,11,1,5,0,0],[0,0,9,11,11,12,12,12,11,11,5,0,0],[0,4,11,11,12,12,12,12,12,11,11,4,0],[9,11,11,12,12,12,12,12,12,12,11,11,9],[11,11,12,12,12,12,12,12,12,12,12,11,11],[0,11,12,12,12,12,12,12,12,12,12,11,0],[0,11,12,12,12,12,12,12,12,12,12,11,0],[0,11,12,12,12,18,4,17,12,12,12,11,0],[0,11,12,12,0,3,15,5,0,12,12,11,0]],[[0,0,0,0,0,0,0,0,0,0,1,0,0],[0,1,13,13,0,6,0,1,0,0,0,0,0],[0,0,13,13,1,11,11,11,13,13,0,6,0],[0,0,0,0,0,11,11,11,13,13,1,0,0],[0,6,0,0,13,13,0,11,0,0,0,0,0],[11,11,1,0,13,13,6,0,0,0,0,1,0],[11,11,11,0,0,0,0,0,0,6,0,0,6],[0,1,13,13,0,1,0,0,0,0,0,0,0],[6,0,13,13,11,11,13,13,11,11,0,1,0],[0,0,0,0,11,0,13,13,11,11,13,13,0],[0,0,0,6,11,0,0,0,11,11,13,13,0],[0,0,1,0,1,18,4,17,0,0,0,0,0],[1,0,0,0,0,3,15,5,0,1,6,0,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,4,4,0,0,0,9,0,0],[0,9,9,0,4,11,11,9,0,4,11,4,0],[4,11,11,4,11,11,11,11,4,11,11,11,4],[11,11,11,11,11,11,11,11,11,11,11,11,11],[6,11,13,11,11,11,11,11,13,11,11,11,11],[11,11,13,13,13,11,11,11,13,13,13,11,6],[11,11,11,11,13,11,6,11,11,11,13,11,11],[11,11,11,11,11,11,11,11,11,11,11,11,11],[11,11,11,11,11,2,2,11,11,11,11,11,7],[7,11,11,11,2,0,0,2,11,11,11,7,0],[0,7,2,2,0,18,4,17,2,2,2,0,0],[0,0,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,13,0,0,0,0,13,0,0,0,0],[13,13,0,13,0,13,13,13,13,0,13,13,13],[11,11,1,0,0,1,0,0,13,0,13,11,13],[11,13,13,13,13,0,6,0,0,1,11,11,11],[11,11,0,13,0,0,13,0,13,13,13,13,11],[13,13,0,13,0,13,13,0,0,13,0,0,0],[0,0,1,11,1,0,1,11,0,13,0,0,13],[0,13,13,11,13,13,13,13,0,11,1,0,13],[1,0,0,1,0,0,13,0,11,11,13,0,13],[13,13,0,13,13,0,13,1,13,13,13,0,0],[0,0,1,0,11,11,0,0,11,13,0,0,13],[0,13,13,13,11,18,4,17,0,13,0,13,13],[0,13,0,0,0,3,15,5,0,0,0,0,0]],[[12,12,12,12,12,12,12,12,12,12,12,12,12],[12,12,12,12,12,12,12,12,12,12,12,12,12],[12,12,12,1,12,12,12,12,12,1,12,12,12],[12,1,0,1,0,1,12,1,0,1,0,1,12],[12,2,2,1,0,0,0,0,0,1,2,2,12],[12,12,12,1,4,1,6,1,4,1,12,12,12],[6,12,12,12,0,7,0,7,0,12,12,12,6],[12,12,12,12,0,4,0,4,0,12,12,12,12],[12,12,12,12,0,1,0,1,0,12,12,12,12],[12,12,12,1,0,0,4,0,0,1,12,12,12],[12,1,12,1,0,7,7,7,0,1,12,1,12],[0,1,4,1,0,18,4,17,0,1,4,1,0],[0,2,0,0,0,3,15,5,0,0,0,2,0]],[[0,0,0,0,6,0,0,0,0,6,0,0,0],[0,6,0,0,0,6,0,0,6,11,11,0,0],[0,0,6,0,0,0,0,6,11,9,10,0,0],[0,0,0,6,0,11,11,11,11,11,0,8,0],[0,10,0,0,6,11,11,6,11,0,0,6,0],[0,7,10,11,0,6,11,11,6,0,0,8,0],[0,0,11,11,11,11,11,0,0,6,0,0,0],[0,9,10,11,0,6,11,0,0,0,6,0,0],[0,11,11,11,6,0,6,0,9,0,0,6,0],[11,11,11,6,0,0,0,0,8,0,0,0,0],[0,0,6,0,0,0,0,0,0,0,0,8,6],[0,0,0,0,0,18,4,17,0,9,10,0,0],[10,0,9,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,0,5,3,0,0,0,0,0,0,0],[5,5,5,3,0,5,0,0,5,5,0,0,0],[5,5,5,1,1,0,0,0,5,1,5,0,0],[3,3,0,1,5,0,0,3,5,1,1,0,0],[0,5,0,1,3,5,0,5,1,1,1,0,0],[0,5,3,0,0,1,5,1,3,3,1,0,0],[0,5,0,0,3,1,1,5,0,5,1,0,0],[0,3,0,0,5,1,1,5,0,5,1,0,0],[0,3,2,2,0,1,1,1,0,5,5,2,1],[0,3,0,0,3,5,1,3,5,5,5,3,3],[0,0,5,0,1,3,5,1,1,0,0,3,0],[0,0,5,3,5,18,4,17,1,5,0,5,0],[0,0,5,3,0,3,15,5,0,1,1,0,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,0,1,0,0,0,0,0,0],[11,0,0,11,1,11,1,11,0,0,11,0,0],[1,11,11,1,1,1,1,1,11,11,1,11,0],[1,1,1,1,6,1,6,1,1,1,1,11,0],[13,13,13,1,1,1,1,1,13,13,13,11,0],[13,1,1,1,1,1,1,1,1,1,13,13,11],[1,1,1,13,1,1,1,13,1,1,1,11,11],[1,1,13,13,13,1,13,13,13,1,1,13,13],[11,13,13,11,11,11,11,11,13,13,11,13,11],[0,11,11,0,0,0,0,0,11,11,0,11,0],[0,0,0,0,0,18,4,17,0,0,0,0,0],[0,0,0,0,0,3,15,5,0,0,0,0,0]]],F={0:[0,6,12],12:[4,8]},ut=[[11,5],[11,6],[11,7],[12,5],[12,6],[12,7]];class v{constructor(){i(this,"mapData",dt);i(this,"customMap",null)}static clearBrickWall(t){ut.forEach(([e,r])=>t[e][r]=0)}static clearBirthPlace(t){for(const e in F)for(const r of F[e])t[e][r]=0}static fixMapData(t){return this.clearBrickWall(t),this.clearBirthPlace(t),t}setCustomMap(t){this.customMap=t;const e=t.map(r=>r.join(",")).join("], [");console.log(`[[${e}]]`),console.log(this.customMap)}getTemplateMap(){return W}getCustomMap(){return this.customMap}getMap(t){let e;if(this.customMap)e=this.customMap,this.customMap=null;else{const r=t%35||35;e=this.mapData[r-1]||W}return v.fixMapData(e)}}const L=new v;class y{constructor(){i(this,"eventManager",s.EM);i(this,"zIndex",1);i(this,"camp","neutral");i(this,"direction",0);i(this,"isDestroyed",!1);this.eventManager.fireEvent({type:s.ENTITY.CREATED,entity:this})}destroy(...t){this.isDestroyed=!0,this.eventManager.fireEvent({type:s.ENTITY.DESTROYED,entity:this}),this.eventManager.removeSubscriber(this)}postMove(){}notify(t){}getDestroyed(){return this.isDestroyed}getCenter(){const[t,e,r,a]=this.rect;return[t+r/2,e+a/2]}getDirection(){return this.direction}setDirection(t){this.direction=t}setRect(t){this.rect=t}getRect(){return this.rect}getCamp(){return this.camp}getEntityType(){return this.type}getCollision(){return this.isCollision}getZIndex(){return this.zIndex}}const N=Math.ceil(o.canvas.height/2),$=10;class J extends y{constructor(e,r=!1){super();i(this,"type","curtain");i(this,"rect",[0,0,0,0]);i(this,"isCollision",!1);i(this,"zIndex",5);i(this,"curtainH");i(this,"speed");i(this,"destroyAfterAnimation");this.speed=e==="open"?-$:$,this.curtainH=e==="open"?N:0,this.destroyAfterAnimation=r}setSpeed(e){this.speed=e}update(){this.speed!==0&&(this.curtainH<0?(this.curtainH=0,this.speed=0,this.destroyAfterAnimation&&super.destroy()):this.curtainH>N&&(this.curtainH=N,this.speed=0,this.destroyAfterAnimation&&super.destroy()),this.curtainH+=this.speed)}draw(e){e.save(),e.fillStyle=o.colors.gray,e.fillRect(0,0,o.canvas.width,this.curtainH),e.fillRect(0,o.canvas.height-this.curtainH,o.canvas.width,this.curtainH)}notify(){}}class g{constructor(t,e=1,r=1/0){i(this,"status",[]);i(this,"toggleDuration");i(this,"loop");i(this,"finished",!1);i(this,"loopTick",0);i(this,"toggleTick",0);i(this,"currentIndex",0);this.status=t,this.toggleDuration=e,this.loop=r}refresh(){this.finished=!1,this.loopTick=0,this.toggleTick=0,this.currentIndex=0}update(){this.finished||(this.toggleTick++,this.toggleTick>=this.toggleDuration&&(this.toggleTick=0,this.currentIndex++,this.currentIndex>=this.status.length-1&&(this.loop===1/0?this.currentIndex>this.status.length-1&&(this.currentIndex=0):this.loopTick<this.loop-1?(this.loopTick++,this.currentIndex>this.status.length-1&&(this.currentIndex=0)):(this.currentIndex=this.status.length-1,this.finished=!0))))}setLoop(t){this.loop=t}getStatus(){return this.status[this.currentIndex]}isFinished(){return this.finished}setFinished(t){this.finished=t}}function E(n){return n.type===s.COLLISION.BORDER||n.type===s.COLLISION.ENTITY}function A(n){return n.type===s.KEYBOARD.PRESS||n.type===s.KEYBOARD.RELEASE}function k(n){return!!n.tank}function pt(n){return!!n.base}function gt(n){return!!n.bullet}function yt(n){return!!n.bullet&&n.type===s.BULLET.DESTROYED}function G(n){return!!n.award}function ft(n){return!!n.target}function Tt(n){return k(n)&&!!n.killer}function Et(n){return n.type===s.BRICK.RIVER_FLOW}function kt(n){return n.type===s.AWARD.DETECT}class Y extends y{constructor(){super();i(this,"speed",0);i(this,"moveFrequency",1);i(this,"stop",!0);i(this,"pause",!1);i(this,"lastDirection",0);i(this,"lastRect");i(this,"moveTick",0);this.eventManager.addSubscriber(this,[s.COLLISION.BORDER,s.GAME.PAUSE]),this.lastRect=this.getRect()}turnDirection(){this.lastDirection=this.direction;let[e,r,a,h]=this.rect;this.direction%2?r=Math.round(r/16)*16:e=Math.round(e/16)*16,this.rect=[e,r,a,h]}getLastDirection(){return this.lastDirection}getLastRect(){return this.lastRect}move(){this.speed===0||++this.moveTick<this.moveFrequency||this.pause||(this.moveTick=0,this.lastRect=this.rect,this.rect=this.getNextFrameRect(),this.eventManager.fireEvent({type:s.ENTITY.MOVE,entity:this}),this.postMove())}resolveCollisionBorder(){let[e,r,a,h]=this.rect;const{width:l,height:d}=o.battleField;e+a>l?e=l-a:e<0&&(e=0),r+h>d?r=d-h:r<0&&(r=0),this.rect=[e,r,a,h]}getNextFrameRect(){let[e,r,a,h]=this.rect;return{0:()=>r-=this.speed,1:()=>e+=this.speed,2:()=>r+=this.speed,3:()=>e-=this.speed}[this.direction](),[e,r,a,h]}setStop(e){this.stop=e}getStop(){return this.stop}update(){this.isDestroyed||this.stop||(this.lastDirection===this.direction?this.move():(this.turnDirection(),this.moveTick=this.moveFrequency-1))}notify(e){e.type===s.GAME.PAUSE?this.pause=!this.pause:E(e)&&e.type===s.COLLISION.BORDER&&e.initiator===this&&this.resolveCollisionBorder()}}const{paddingLeft:mt,paddingTop:St}=o.battleField;class _ extends Y{constructor(){super();i(this,"protected",!1);i(this,"bulletLimit",1);i(this,"bullets",0);i(this,"level",1);i(this,"exploded",!1);i(this,"trackStatus",new g([0,1],o.ticker.trackStatus));i(this,"protectorStatus",new g([0,1],o.ticker.protectorStatus,o.ticker.protector));this.eventManager.addSubscriber(this,[s.COLLISION.ENTITY,s.BULLET.DESTROYED,s.BULLET.CREATE])}shoot(){this.bullets<this.bulletLimit&&this.shootStatus.isFinished()&&(this.bullets+=1,this.shootStatus.refresh(),this.eventManager.fireEvent({type:s.TANK.SHOOT,tank:this}))}getLevel(){return this.level}getExploded(){return this.exploded}isProtected(){return this.protected}explosion(){this.protected||(this.exploded=!0,this.destroy())}update(){this.protected&&(this.protectorStatus.update(),this.protectorStatus.isFinished()&&(this.protected=!1)),super.update()}postMove(){this.trackStatus.update(),this.camp}removeProtector(){this.protected=!1,this.protectorStatus.setFinished(!0)}addProtector(){this.protected=!0,this.protectorStatus.refresh()}upGrade(e=1){e===4?this.level=this.level<=4?4:this.level:this.level=++this.level>6?6:this.level,this.level>=3&&(this.bulletLimit=2)}destroy(){this.eventManager.fireEvent({type:s.TANK.DESTROYED,tank:this}),c.Audio.play("explosion"),super.destroy()}draw(e){if(this.protected){const[r,a]=this.rect;e.drawImage(c.Image.tool,(1+this.protectorStatus.getStatus())*32,0,32,32,r+mt,a+St,32,32)}}resolveCollisionEntity(e){const[r,a,h,l]=this.rect,[d,w,nt,ot]=e.getRect();let M=r,R=a;switch(this.direction){case 0:R=w+ot;break;case 1:M=d-h;break;case 2:R=w-l;break;case 3:M=d+nt;break}Math.abs(r-M)>8||Math.abs(a-R)>8||(this.rect=[M,R,h,l])}pickAward(e){if(!(this.getCamp()==="enemy"&&!window.allowEnemyPick)){switch(e.getAwardType()){case 0:this.camp==="enemy"?this.eventManager.fireEvent({type:s.AWARD.ENEMY_PICK_SPADE,award:e,picker:this}):this.eventManager.fireEvent({type:s.AWARD.ALLY_PICK_SPADE,award:e,picker:this});break;case 1:this.upGrade();break;case 2:this.addLife();break;case 3:this.addProtector();break;case 4:this.camp==="enemy"?this.eventManager.fireEvent({type:s.AWARD.ENEMY_PICK_BOMB,award:e,picker:this}):this.eventManager.fireEvent({type:s.AWARD.ALLY_PICK_BOMB,award:e,picker:this});break;case 5:this.camp==="enemy"?this.eventManager.fireEvent({type:s.AWARD.ENEMY_PICK_MINE,award:e,picker:this}):this.eventManager.fireEvent({type:s.AWARD.ALLY_PICK_MINE,award:e,picker:this});break;case 6:this.upGrade(4);break}if(this.camp==="ally")switch(e.getAwardType()){case 2:case 4:break;default:c.Audio.play("eat")}}}notify(e){super.notify(e);const{type:r,initiator:a,entity:h}=e;if(E(e)&&r===s.COLLISION.ENTITY)if(a===this){const l=h.getEntityType();switch(l){case"allyTank":case"enemyTank":case"base":case"brick":if(!h.getCollision()||l==="brick"&&h.getBrickType()==="grass")return;this.resolveCollisionEntity(h);break;case"bullet":h.getCamp()!==this.camp&&this.hit(h);break;case"award":this.pickAward(h);break}}else h===this&&a.getEntityType()==="bullet"&&a.getCamp()!==this.getCamp()&&this.hit(a);else gt(e)&&r===s.BULLET.DESTROYED&&e.bullet.getTank()===this&&(this.bullets-=1)}}const{paddingLeft:bt,paddingTop:At}=o.battleField,Q={P1:[128,384,32,32],P2:[256,384,32,32]};class wt extends _{constructor(e){super();i(this,"type","allyTank");i(this,"rect");i(this,"isCollision",!0);i(this,"shootStatus",new g([0,1],o.ticker.allyShot,1));i(this,"player");i(this,"clipX");i(this,"shooting",!1);i(this,"slide",!1);i(this,"slideStatus",new g([0],10,1));this.rect=Q[e.getRoleType()],this.player=e,this.camp="ally",this.direction=0,this.clipX=e.getRoleType()==="P1"?0:32*4,this.speed=o.speed.ally,this.shootStatus.setFinished(!0),this.protectorStatus.setLoop(o.ticker.protectorShort),this.protectorStatus.refresh(),this.protected=!0,this.eventManager.addSubscriber(this,[s.TANK.ALLY_TANK_SLIDE])}inheritFromTank(e){this.level=e.getLevel(),this.level>=3&&(this.bulletLimit=2)}setPlayer(e){this.player=e}getPlayer(){return this.player}setShooting(e){this.shooting=e}addProtector(){this.protectorStatus.setLoop(o.ticker.protector),super.addProtector()}update(){super.update(),this.shootStatus.update(),this.shooting&&super.shoot(),this.slide&&(this.move(),this.slideStatus.update(),this.slideStatus.isFinished()&&(this.slide=!1))}setStop(e){this.slide||(this.stop=e,e&&this.eventManager.fireEvent({type:s.TANK.ALLY_TANK_STOP,tank:this}))}destroy(e){this.eventManager.fireEvent({type:s.TANK.ALLY_TANK_DESTROYED,tank:this,killer:e}),super.destroy()}hit(e){this.protected||(this.level>=4?(this.bulletLimit=1,this.level=2,c.Audio.play("hit")):this.destroy(e.getTank()))}addLife(){this.player.addLife()}draw(e){if(this.isDestroyed)return;const[r,a,h,l]=this.rect;e.drawImage(c.Image.myTank,this.clipX+(Math.min(this.level,4)-1)*32,(this.direction*2+this.trackStatus.getStatus())*32,32,32,r+bt,a+At,h,l),super.draw(e)}notify(e){super.notify(e),e.type===s.TANK.ALLY_TANK_SLIDE&&k(e)&&e.tank===this&&(this.slide=!0,this.slideStatus.refresh())}}class Mt{constructor(t){i(this,"eventManager",s.EM);i(this,"tank");i(this,"role");i(this,"pause",!1);i(this,"defeat",!1);i(this,"hasShoot",!1);i(this,"pressedKeys",new Set);i(this,"palsy",!1);this.tank=t,this.role=t.getPlayer().getRoleType(),this.eventManager.addSubscriber(this,[s.KEYBOARD.PRESS,s.KEYBOARD.RELEASE,s.GAME.PAUSE,s.TANK.ALLY_TANK_DESTROYED,s.MINE.ALLY_OVER,s.BASE.DESTROY,s.AWARD.ENEMY_PICK_MINE])}setPalsy(t){this.palsy=t}getPalsy(){return this.palsy}keyPress(t){const{UP:e,DOWN:r,RIGHT:a,LEFT:h,A:l,B:d}=s.CONTROL[this.role];switch([e,r,a,h].includes(t)&&this.pressedKeys.add(t),t){case e:this.tank.setDirection(0),this.tank.setStop(!1);break;case a:this.tank.setDirection(1),this.tank.setStop(!1);break;case r:this.tank.setDirection(2),this.tank.setStop(!1);break;case h:this.tank.setDirection(3),this.tank.setStop(!1);break;case l:if(this.hasShoot)return;this.tank.shoot(),this.hasShoot=!0;break;case d:this.tank.setShooting(!0);break}}releaseKey(t){const{UP:e,DOWN:r,RIGHT:a,LEFT:h,A:l,B:d}=s.CONTROL[this.role];if(this.pressedKeys.delete(t),this.pressedKeys.size>0&&![l,d].includes(t)){this.keyPress(Array.from(this.pressedKeys)[0]);return}switch(t){case e:case a:case r:case h:this.tank.setStop(!0);break;case l:this.hasShoot=!1;break;case d:this.tank.setShooting(!1);break}}notify(t){if(!this.defeat){if(t.type===s.BASE.DESTROY){this.defeat=!0,this.tank.setStop(!0),this.tank.setShooting(!1);return}if(t.type===s.GAME.PAUSE){this.pause=!this.pause;return}if(!this.pause){if(t.type===s.MINE.ALLY_OVER){this.palsy=!1;return}else if(this.palsy)return;if(t.type===s.AWARD.ENEMY_PICK_MINE&&(this.palsy=!0,this.tank.setStop(!0),this.tank.setShooting(!1)),A(t)){t.type===s.KEYBOARD.PRESS?this.keyPress(t.key):t.type===s.KEYBOARD.RELEASE&&this.releaseKey(t.key);return}k(t)&&t.type===s.TANK.ALLY_TANK_DESTROYED&&t.tank===this.tank&&this.eventManager.removeSubscriber(this)}}}}const{paddingLeft:Rt,paddingTop:It}=o.battleField;class tt extends y{constructor(e,r){super();i(this,"isCollision",!1);i(this,"type","spriteAnimation");i(this,"rect");i(this,"animationTicker",new g([4,3,2,1,2,3],o.ticker.birthStatus));i(this,"survivalTicker");this.rect=e,this.survivalTicker=new p(o.ticker.birth,()=>{this.destroy(),r()})}update(){this.animationTicker.update(),this.survivalTicker.update()}draw(e){const[r,a,h,l]=this.rect;e.drawImage(c.Image.bonus,this.animationTicker.getStatus()*32,64,32,32,r+Rt,a+It,h,l)}notify(){}}const Lt=245,O=470;class Dt{constructor(t,e){i(this,"eventManager",s.EM);i(this,"createTask",[]);i(this,"players",[]);i(this,"defeat",!1);i(this,"palsy",!1);i(this,"stage");this.stage=e,this.players=t,this.players.forEach(r=>{this.create(r),r.resetKillRecord()}),this.eventManager.addSubscriber(this,[s.TANK.ALLY_TANK_DESTROYED,s.BASE.DESTROY,s.MINE.ALLY_OVER,s.AWARD.ENEMY_PICK_MINE])}create(t){const e=t.getRoleType(),r=Q[e],a=t.getTank();!a&&t.getLife()===0||(!a&&t.getLife()>0&&t.reduceLife(),new tt(r,()=>{const h=new wt(t);a&&h.inheritFromTank(a),t.setTank(h),this.defeat||new Mt(h).setPalsy(this.palsy)}))}update(){this.createTask.forEach(t=>t.update())}draw(t){t.save(),t.fillStyle=o.colors.black,t.font="16px prestart",t.textBaseline="alphabetic",this.players.forEach((e,r)=>{const a=Lt+50*r;t.fillText(`${r+1}P`,O,a),t.drawImage(c.Image.tool,16,16,16,16,O,a+4,16,16),t.fillText(e.getLife().toString(),O+16,a+18)}),t.drawImage(c.Image.tool,128,0,32,32,470,345,32,32),t.textAlign="center",t.fillText(this.stage.toString(),495,385),t.restore()}notify(t){if(k(t)&&t.type===s.TANK.ALLY_TANK_DESTROYED){const e=t.tank.getPlayer();if(e.setTank(null),this.players.filter(r=>r.getTank()||r.getLife()>0).length>0)this.createTask.push(new p(o.entity.createAllyInterval,()=>{this.create(e)}));else{this.defeat=!0,this.eventManager.fireEvent({type:s.GAME.DEFEAT});return}}else t.type===s.BASE.DESTROY?this.defeat=!0:t.type===s.MINE.ALLY_OVER?this.palsy=!1:t.type===s.AWARD.ENEMY_PICK_MINE&&(this.palsy=!0)}}const{paddingLeft:Nt,paddingTop:Ot}=o.battleField;class Ct extends _{constructor(e,r){super();i(this,"type","enemyTank");i(this,"rect");i(this,"isCollision",!0);i(this,"shootStatus",new g([0,1],o.ticker.enemyShoot,1));i(this,"award",0);i(this,"armor",0);i(this,"enemyType");this.rect=e,this.enemyType=r,this.direction=2,this.stop=!1,this.camp="enemy",this.shootStatus.setFinished(!0),this.initSpeed()}hit(e){if(!this.protected){if(this.level>=4?this.level--:(this.level=1,this.bulletLimit=1),c.Audio.play("hit"),this.award>=1){this.award--,this.eventManager.fireEvent({type:s.TANK.AWARD_TANK_HIT,tank:this});return}if(this.armor>=1){this.armor--;return}this.destroy(e.getTank())}}initSpeed(){const{enemySlow:e,enemyFast:r,enemyNormal:a}=o.speed;switch(this.enemyType){case 0:case 1:this.speed=a;break;case 2:this.speed=r;break;case 3:default:this.speed=e;break}}destroy(e){this.eventManager.fireEvent({type:s.TANK.ENEMY_TANK_DESTROYED,tank:this,killer:e}),super.destroy()}addLife(){this.award=m(1,3)}update(){this.bullets===0&&this.shootStatus.update(),super.update()}setAward(e){this.award=e}setArmor(e){this.armor=e}getEnemyType(){return this.enemyType}draw(e){if(this.isDestroyed)return;let r=this.enemyType*64+(this.award>0?32:0);this.enemyType===3&&(r=this.award>0?288:192+Math.min(this.armor,2)*32);const[a,h,l,d]=this.rect;e.drawImage(c.Image.enemyTank,r,(this.direction*2+this.trackStatus.getStatus())*32,32,32,a+Nt,h+Ot,l,d),super.draw(e)}}class Pt{constructor(t){i(this,"tank");i(this,"palsy",!1);i(this,"eventManager",s.EM);i(this,"changeDirectionInterval",45);i(this,"changeDirectionTicker",0);this.tank=t,this.eventManager.addSubscriber(this,[s.COLLISION.BORDER,s.COLLISION.ENTITY,s.TANK.ENEMY_TANK_DESTROYED])}setPalsy(t){this.palsy=t}getRandomDirection(t){return Math.random()<.3?t:Math.floor(Math.random()*4)}changeDirection(t=!1){if(this.changeDirectionTicker<this.changeDirectionInterval||!t&&Math.random()<.995)return;this.changeDirectionTicker=0;const[e,r]=o.base,[a,h]=this.tank.getRect();let l=this.tank.getDirection();const d=()=>{h<r?l=this.getRandomDirection(2):a<e?l=this.getRandomDirection(1):l=this.getRandomDirection(3)};for(;l===this.tank.getLastDirection()||l===this.tank.getDirection();)d();this.tank.setDirection(l)}getTank(){return this.tank}update(){this.palsy||(this.tank.shoot(),this.changeDirectionTicker++,this.changeDirection())}notify(t){if(!this.palsy){if(E(t)&&t.initiator===this.tank){if(t.type===s.COLLISION.BORDER){this.changeDirection(!0);return}switch(t.entity.getEntityType()){case"allyTank":case"enemyTank":case"brick":this.changeDirection(!0);break;case"base":t.entity.getDestroyed()||this.changeDirection(!0);break}}k(t)&&t.type===s.TANK.ENEMY_TANK_DESTROYED&&this.tank===t.tank&&this.eventManager.removeSubscriber(this)}}}class vt{constructor(){i(this,"palsy",!1);i(this,"eventManager",s.EM);i(this,"controllers",[]);this.eventManager.addSubscriber(this,[s.MINE.ENEMY_OVER,s.AWARD.ALLY_PICK_MINE])}setPalsy(t){this.palsy=t,this.controllers.forEach(e=>{e.setPalsy(t),e.getTank().setStop(t)})}getAllController(){return this.controllers}addController(t){this.controllers.push(t),this.setPalsy(this.palsy)}removeController(t){for(let e=0;e<this.controllers.length;e++)this.controllers[e]===t&&this.controllers.splice(e,1)}update(){this.controllers.forEach(t=>t.update())}notify(t){t.type===s.AWARD.ALLY_PICK_MINE?this.setPalsy(!0):t.type===s.MINE.ENEMY_OVER&&this.setPalsy(!1)}}const{paddingLeft:Yt,paddingTop:_t}=o.battleField,Kt=_t+20,xt=Yt+o.battleField.width+15,Bt=[[0,0],[6,0],[12,0]];class Wt{constructor(){i(this,"eventManager",s.EM);i(this,"enemies","");i(this,"enemyCount",0);i(this,"enemyAlive",0);i(this,"birthIndex",1);i(this,"createTick",o.entity.createEnemyInterval);i(this,"controllerContainer",new vt);i(this,"pause",!1);this.eventManager.addSubscriber(this,[s.TANK.ENEMY_TANK_DESTROYED,s.GAME.PAUSE])}update(){this.controllerContainer.update(),this.createTick++,!(this.pause||this.enemyCount>=this.enemies.length||this.enemyAlive>=o.entity.maxEnemyAlive||this.createTick<=o.entity.createEnemyInterval)&&this.createEnemy()}setEnemies(t){this.enemies=t}createEnemy(){const[t,e]=Bt[this.birthIndex%3],r=this.enemies[this.enemyCount];this.createTick=0,this.enemyAlive++,this.enemyCount++,this.birthIndex++;const a=[t*32,e*32,32,32];new tt(a,()=>{const h=new Ct(a,Number(r)),l=m(0,10)>7?Math.floor(Math.sqrt(m(1,16)))-1:0,d=Number(r)===3&&Math.random()>.5?Math.floor(Math.sqrt(m(1,9))):0;h.setAward(l),h.setArmor(d),this.controllerContainer.addController(new Pt(h))})}draw(t){const e=this.enemies.length-this.enemyCount;for(let r=0;r<e;r++){const a=r%2,h=r/2|0;t.drawImage(c.Image.tool,0,16,16,16,xt+a*16,Kt+h*16,16,16)}}notify(t){if(t.type===s.GAME.PAUSE)this.pause=!this.pause;else if(k(t)&&t.type===s.TANK.ENEMY_TANK_DESTROYED){this.enemyAlive--,this.enemyAlive===0&&this.enemyCount>=this.enemies.length&&this.eventManager.fireEvent({type:s.TANK.LAST_ENEMY_TANK_DESTROYED});const e=t.tank,r=this.controllerContainer.getAllController();for(let a=0;a<r.length;a++)if(r[a].getTank()===e){this.controllerContainer.removeController(r[a]);break}}}}const Ft=["00000000000000000011","00000100010001001303","00000100010001001303","02102121221223221233","00120100120021021323","00120202020103202023","00100210202002102012","20202100210021302123","20100102302102321232","00102003012000200203","12131132131213113213","21123321321321321232","21112312132132121232","12212122132323232323","10310131131131313133","00010000100030000003","00313030303130303033","21021012132112312313","01230123012301233333","01232323230123232323","20120202320123023023","01201301031201130113","21112113113213131323","01200210001200213003","11313312313132133133","01232301230123012313","02323232302323123123","00000000000101003202","12132213223231232223","10121310112131011231","12311231213123112323","20130031030313031323","21132131231132331313","11212111313123131323","21313131313312332323"];class $t{constructor(){i(this,"eventManager",s.EM)}detectBorder(t){const[e,r,a,h]=t.getRect();let l;return e<0?l=0:e>o.battleField.width-a?l=2:r<0?l=3:r>o.battleField.width-h&&(l=1),l!==void 0?(this.eventManager.fireEvent({type:s.COLLISION.BORDER,initiator:t,collisionType:l}),!0):!1}detectEntity(t,e){[...t].forEach(r=>{r!==e&&S(e.getRect(),r.getRect())&&this.eventManager.fireEvent({type:s.COLLISION.ENTITY,initiator:e,entity:r})})}detectTankSlide(t,e){t.forEach(r=>{r!==e&&r.getEntityType()==="brick"&&r.getBrickType()==="ice"&&S(r.getRect(),e.getRect())&&this.eventManager.fireEvent({type:s.TANK.ALLY_TANK_SLIDE,tank:e})})}detect(t,e){this.detectBorder(e),this.detectEntity(t,e)}}class K{constructor(){i(this,"entities",[]);i(this,"eventManager",s.EM);i(this,"collisionDetecter");this.eventManager.addSubscriber(this,[s.ENTITY.CREATED,s.ENTITY.DESTROYED,s.ENTITY.MOVE,s.AWARD.CREATE,s.TANK.ALLY_TANK_STOP]),this.collisionDetecter=new $t}sortEntityByZIndex(){this.entities.sort((t,e)=>t.getZIndex()>e.getZIndex()?1:t.getZIndex()<e.getZIndex()?-1:0)}update(){[...this.entities].forEach(t=>t.update())}draw(t){[...this.entities].forEach(e=>e.draw(t))}addEntity(t){this.entities.push(t),this.sortEntityByZIndex()}removeEntity(t){for(let e=0;e<this.entities.length;e++)if(this.entities[e]===t){this.entities.splice(e,1);return}}clearEntity(){this.entities=[]}getAllEntity(){return[...this.entities]}notify(t){switch(t.type){case s.ENTITY.CREATED:this.addEntity(t.entity);break;case s.ENTITY.DESTROYED:this.removeEntity(t.entity);break;case s.ENTITY.MOVE:this.collisionDetecter.detect(this.getAllEntity(),t.entity);break;case s.AWARD.CREATE:this.eventManager.fireEvent({type:s.AWARD.DETECT,entities:this.getAllEntity()});break;case s.TANK.ALLY_TANK_STOP:this.collisionDetecter.detectTankSlide(this.getAllEntity(),t.tank);break;default:console.warn(`useless event subScriber: ${t.type}`);break}}}var u=(n=>(n[n.blank=0]="blank",n[n.brick=1]="brick",n[n.brickTop=2]="brickTop",n[n.brickRight=3]="brickRight",n[n.brickBottom=4]="brickBottom",n[n.brickLeft=5]="brickLeft",n[n.iron=6]="iron",n[n.ironTop=7]="ironTop",n[n.ironRight=8]="ironRight",n[n.ironBottom=9]="ironBottom",n[n.ironLeft=10]="ironLeft",n[n.grass=11]="grass",n[n.ice=12]="ice",n[n.river1=13]="river1",n[n.river2=14]="river2",n[n.boss=15]="boss",n[n.bossBroken=16]="bossBroken",n[n.brickLeftBottom=17]="brickLeftBottom",n[n.brickRightBottom=18]="brickRightBottom",n[n.ironLeftBottom=19]="ironLeftBottom",n[n.ironRightBottom=20]="ironRightBottom",n))(u||{});const Gt=[1,6,11,12,13,14,15,16],et=[3,4,8,9,17,18,19,20],it=[5,4,10,9,17,18,19,20],st=[2,3,7,8,18,20],rt=[2,5,7,10,5,17,19],Ut=[1,2,3,4,5,17,18],Ht=[6,7,8,9,10,19,20],Vt=[13,14];function P(n){return Ut.includes(n)?"brick":Ht.includes(n)?"iron":n===u.grass?"grass":n===u.ice?"ice":Vt.includes(n)?"river":"blank"}const zt=o.battleField.paddingLeft,Xt=o.battleField.paddingTop,Zt={iron:u.iron,brick:u.brick,grass:u.grass};class x extends y{constructor(e,r){super();i(this,"isCollision",!0);i(this,"type","brick");i(this,"rect");i(this,"brickType");i(this,"status");i(this,"ctx");i(this,"sprite");i(this,"fragmentIndex");i(this,"brickIndex");this.rect=e,this.brickIndex=r,this.status=[1,1,1,1],this.brickType=P(r),this.getFragmentIndex(),this.getImage(),this.eventManager.addSubscriber(this,[s.COLLISION.ENTITY])}getBrickIndex(){return this.brickIndex}getBrickType(){return this.brickType}getFragmentIndex(){this.fragmentIndex=Zt[P(this.brickIndex)]||0}getImage(){const[,,e,r]=this.rect,[a,h]=j(e,r);h.drawImage(c.Image.brick,this.fragmentIndex*32,0,e,r,0,0,e,r),this.sprite=a,this.ctx=h}clipSprite(){this.status.forEach((e,r)=>{if(e===0){const a=[1,3].includes(r)?8:0,h=[2,3].includes(r)?8:0;this.ctx.clearRect(a,h,8,8)}})}reduce(e){const[r,a,h,l]={0:[2,3,0,1],1:[0,2,1,3],2:[0,1,2,3],3:[1,3,2,0]}[e.getDirection()];this.status[r]===0&&this.status[a]===0?this.status[h]=this.status[l]=0:this.status[r]=this.status[a]=0,this.clipSprite()}destroy(e){if(!["river","ice","blank"].includes(this.brickType))switch(this.brickType){case"brick":if(e.getLevel()>=4)return super.destroy(e);if(this.reduce(e),this.status.reduce((r,a)=>r+a)===0)return super.destroy(e);break;case"iron":e.getLevel()>=4&&super.destroy();break;case"grass":e.getLevel()>=6&&super.destroy();break}}update(){}draw(e){const[r,a,h,l]=this.rect;e.drawImage(this.sprite,r+zt,a+Xt,h,l)}notify(e){E(e)&&e.type===s.COLLISION.ENTITY&&e.entity===this&&e.initiator.getEntityType()==="bullet"&&this.destroy(e.initiator)}}const{paddingLeft:qt,paddingTop:jt}=o.battleField,Jt=[{x:0,y:0},{x:16,y:0},{x:0,y:16},{x:16,y:16}],Qt={iron:u.iron,brick:u.brick,grass:u.grass};class te extends y{constructor(e){super();i(this,"type","brick");i(this,"isCollision");i(this,"isBrickFragment",!1);i(this,"brickIndex");i(this,"brickType");i(this,"rect",[0,0,32,32]);i(this,"status",0);switch(this.eventManager.addSubscriber(this,[s.COLLISION.ENTITY]),this.brickIndex=e,this.brickType=P(e),this.isCollision=!["ice","blank"].includes(this.brickType),this.brickType){case"grass":this.zIndex=3;break;case"ice":this.zIndex=-1;break;default:this.zIndex=0}this.brickType==="river"&&this.eventManager.addSubscriber(this,[s.BRICK.RIVER_FLOW])}broken(e){Jt.forEach((r,a)=>{if(a===0&&et.includes(this.brickIndex)||a===1&&it.includes(this.brickIndex)||a===2&&st.includes(this.brickIndex)||a===3&&rt.includes(this.brickIndex))return;const[h,l]=this.rect,d=[r.x+h,r.y+l,16,16],w=new x(d,Qt[this.brickType]||0);S(d,e.getRect())&&w.destroy(e)}),super.destroy()}update(){}getBrickType(){return this.brickType}getBrickIndex(){return this.brickIndex}destroy(e){if(this.isBrickFragment)return super.destroy();switch(this.brickIndex){case u.brick:this.broken(e);break;case u.iron:e.getLevel()>=4&&this.broken(e);break;case u.grass:e.getLevel()===6&&this.broken(e);break}}draw(e){const[r,a,h,l]=this.rect,d=this.status;e.drawImage(c.Image.brick,32*(this.brickIndex+d),0,32,32,r+qt,a+jt,h,l)}notify(e){E(e)&&e.type===s.COLLISION.ENTITY&&e.entity===this&&e.initiator.getEntityType()==="bullet"?this.destroy(e.initiator):Et(e)&&(this.status=e.status)}}class at{constructor(t,e,r=1,a=1/0){i(this,"delay");i(this,"delayTick",0);i(this,"statusToggle");this.delay=t,this.statusToggle=new g(e,r,a)}update(){this.delayTick<this.delay?this.delayTick++:this.statusToggle.update()}refresh(){this.delayTick=0,this.statusToggle.refresh()}getStatus(){return this.statusToggle.getStatus()}setFinished(t){t?(this.delayTick=this.delay,this.statusToggle.setFinished(t)):this.refresh()}isFinished(){return this.delayTick>=this.delay&&this.statusToggle.isFinished()}}class f extends x{constructor(e){super(e,1);i(this,"brickType","brickWall");i(this,"wallType","brick");i(this,"lastStatus",u.brick);i(this,"buildTicker",new at(o.ticker.wallBuildKeep,[u.iron,u.brick],o.ticker.wallBlinkStatus,15));this.buildTicker.setFinished(!0),this.eventManager.addSubscriber(this,[s.AWARD.ENEMY_PICK_SPADE,s.AWARD.ALLY_PICK_SPADE])}build(e){this.isDestroyed=!1,this.isCollision=!0,this.status=[1,1,1,1],this.brickIndex=u[e],this.wallType=e,this.getFragmentIndex(),this.getImage()}rebuild(){this.lastStatus=u.brick,this.buildTicker.refresh()}update(){if(!this.buildTicker.isFinished()){this.buildTicker.update();const e=this.buildTicker.getStatus();e!==this.lastStatus&&(this.lastStatus=e,this.build(e===u.iron?"iron":"brick"))}}destroy(){setTimeout(()=>{this.isDestroyed=!0,this.isCollision=!1},0)}hit(e){if(this.wallType==="brick")if(e.getLevel()<4){if(this.reduce(e),this.status.reduce((r,a)=>r+a)===0)return this.destroy()}else this.destroy();else e.getLevel()>=4&&this.destroy()}draw(e){this.isDestroyed||super.draw(e)}notify(e){E(e)&&e.type===s.COLLISION.ENTITY&&e.entity===this&&e.initiator.getEntityType()==="bullet"?this.hit(e.initiator):e.type===s.AWARD.ALLY_PICK_SPADE?this.rebuild():e.type===s.AWARD.ENEMY_PICK_SPADE&&this.destroy()}}const{paddingLeft:ee,paddingTop:ie}=o.battleField;class se extends y{constructor(){super();i(this,"isCollision",!0);i(this,"type","base");i(this,"rect",[192,384,32,32]);this.eventManager.addSubscriber(this,[s.COLLISION.ENTITY])}hit(){this.isDestroyed||(this.eventManager.fireEvent({type:s.BASE.DESTROY,base:this}),this.isDestroyed=!0,c.Audio.play("bomb"))}update(){}draw(e){const[r,a,h,l]=this.rect;e.drawImage(c.Image.brick,(this.isDestroyed?16:15)*32,0,32,32,r+ee,a+ie,h,l)}notify(e){E(e)&&e.type===s.COLLISION.ENTITY&&e.entity===this&&e.initiator.getEntityType()==="bullet"&&this.hit()}}const re=[{x:0,y:0},{x:16,y:0},{x:0,y:16},{x:16,y:16}];class T{static newBrick(t,e){Gt.includes(t)?new te(t).setRect(e):this.broken(t,e)}static broken(t,e){re.forEach((r,a)=>{if(a===0&&et.includes(t)||a===1&&it.includes(t)||a===2&&st.includes(t)||a===3&&rt.includes(t))return;const[h,l]=e;new x([r.x+h,r.y+l,16,16],t)})}static buildBrickWall(){new f([176,368,16,16]),new f([192,368,16,16]),new f([208,368,16,16]),new f([224,368,16,16]),new f([176,384,16,16]),new f([224,384,16,16]),new f([176,400,16,16]),new f([224,400,16,16])}static buildBase(){new se}static buildFromMapData(t){for(const e in t)for(const r in t[e]){const a=t[e][r];if(a!==0){const h=[Number(r)*32,Number(e)*32,32,32];T.newBrick(a,h)}}}}const{paddingLeft:ae,paddingTop:ne}=o.battleField;class C extends y{constructor(e,r="base"){super();i(this,"type","explosionAnimation");i(this,"rect");i(this,"isCollision",!1);i(this,"zIndex",4);i(this,"frameStatus");i(this,"explosionTick");i(this,"target");let[a,h]=e.getRect();r==="base"?(a-=16,h-=16):(a-=28,h-=28),this.target=e,this.rect=[a,h,64,64],this.frameStatus=new g(o.explosion[r],o.ticker.explodeStatus),this.explosionTick=new p(r==="base"?o.ticker.explodeBase:o.ticker.explodeBullet)}destroy(){this.target.getEntityType()==="enemyTank"&&this.eventManager.fireEvent({type:s.EXPLOSION.ENEMY_YANK_EXPLOSION,target:this.target}),super.destroy()}update(){this.frameStatus.update(),this.explosionTick.update(),this.explosionTick.isFinished()&&this.destroy()}draw(e){const[r,a,h,l]=this.rect;e.drawImage(c.Image.explode,this.frameStatus.getStatus()*64,0,64,64,r+ae,a+ne,h,l)}}class oe{constructor(){i(this,"eventManager",s.EM);this.eventManager.addSubscriber(this,[s.BULLET.DESTROYED,s.TANK.DESTROYED,s.BASE.DESTROY])}notify(t){yt(t)&&t.explosion?new C(t.bullet,"bullet"):k(t)&&t.type===s.TANK.DESTROYED?new C(t.tank,"base"):pt(t)&&t.type==s.BASE.DESTROY&&new C(t.base,"base")}}class he extends y{constructor(){super();i(this,"type","gameOverFlag");i(this,"rect",[104,0,248,160]);i(this,"isCollision",!1);i(this,"zIndex",4);i(this,"delayTick",new p(o.ticker.defeat));i(this,"toggleY",o.battleField.height/2);i(this,"slideY",o.battleField.height-40);i(this,"speed",3)}update(){this.delayTick.isFinished()?this.slideY>this.toggleY&&(this.slideY-=this.speed,this.slideY<=this.toggleY&&(this.slideY=this.toggleY)):this.delayTick.update()}draw(e){this.delayTick.isFinished()&&(e.save(),e.font="30px prestart",e.fillStyle=o.colors.red1,e.textAlign="center",e.textBaseline="middle",e.fillText("GAME",248,this.slideY),e.fillText("OVER",248,this.slideY+40),e.restore())}}class le{constructor(){i(this,"eventManager",s.EM);i(this,"over",!1);this.eventManager.addSubscriber(this,[s.BASE.DESTROY,s.GAME.DEFEAT])}notify(t){(t.type===s.BASE.DESTROY||t.type===s.GAME.DEFEAT)&&!this.over&&new he}}const{paddingLeft:ce,paddingTop:de}=o.battleField;class ue extends Y{constructor(e){super();i(this,"isCollision",!0);i(this,"rect");i(this,"type","bullet");i(this,"zIndex",3);i(this,"tank");i(this,"level");this.tank=e,this.direction=e.getDirection(),this.rect=this.getBulletRect(),this.level=e.getLevel(),this.camp=e.getCamp(),this.speed=this.level>1?o.speed.bulletEnhance:o.speed.bullet,this.eventManager.addSubscriber(this,[s.COLLISION.ENTITY])}getBulletRect(){let[e,r]=this.tank.getRect();return{0:()=>e+=12,1:()=>(e+=24,r+=12),2:()=>(e+=12,r+=24),3:()=>r+=12}[this.direction](),[e,r,8,8]}getDir(){return this.direction}getTank(){return this.tank}getLevel(){return this.level}update(){this.move()}destroy(e=!0){this.rect=this.getNextFrameRect(),this.eventManager.fireEvent({type:s.BULLET.DESTROYED,bullet:this,explosion:e}),super.destroy()}draw(e){if(!this.isDestroyed){const[r,a,h,l]=this.rect;e.drawImage(c.Image.tool,this.direction*8,0,8,8,r+ce,a+de,h,l)}}notify(e){if(e.type===s.GAME.PAUSE&&(this.pause=!this.pause),E(e)){const{entity:r,initiator:a,type:h}=e;if(a===this){if(h===s.COLLISION.BORDER)this.destroy();else if(h===s.COLLISION.ENTITY&&r.getCollision())switch(r.getEntityType()){case"allyTank":case"enemyTank":this.camp!==r.getCamp()&&r!==this.tank&&this.destroy();break;case"bullet":this.destroy(!1);break;case"base":this.destroy();break;case"brick":["brick","brickWall","iron"].includes(r.getBrickType())&&this.destroy();break}}else if(r===this)switch(a.getEntityType()){case"allyTank":case"enemyTank":this.camp!=a.getCamp()&&this.destroy(!1);break;case"bullet":this.destroy(!1);break}}}}class pe{constructor(){i(this,"eventManager",s.EM);this.eventManager.addSubscriber(this,[s.TANK.SHOOT])}notify(t){k(t)&&t.type===s.TANK.SHOOT&&(new ue(t.tank),t.tank.getCamp()==="ally"&&c.Audio.play("attack"))}}const{paddingLeft:ge,paddingTop:ye}=o.battleField;class U extends y{constructor(e,r){super();i(this,"type","score");i(this,"isCollision",!1);i(this,"rect");i(this,"zIndex",3);i(this,"ticker",new p(o.ticker.score));i(this,"value");this.rect=e,this.value=r}update(){this.ticker.update(),this.ticker.isFinished()&&this.destroy()}draw(e){const[r,a,h,l]=this.rect;e.drawImage(c.Image.bonus,(this.value-1)*32,32,32,32,r+ge,a+ye,h,l)}}class fe{constructor(){i(this,"eventManager",s.EM);this.eventManager.addSubscriber(this,[s.EXPLOSION.ENEMY_YANK_EXPLOSION,s.AWARD.DESTROYED,s.TANK.ENEMY_TANK_DESTROYED,s.AWARD.ALLY_PICK_BOMB,s.AWARD.ALLY_PICK_MINE,s.AWARD.ALLY_PICK_SPADE])}notify(t){var e;switch(t.type){case s.EXPLOSION.ENEMY_YANK_EXPLOSION:{if(ft(t)){const r=t.target;r.getExploded()||new U(r.getRect(),r.getEnemyType()+1)}break}case s.AWARD.DESTROYED:G(t)&&((e=t.picker)==null?void 0:e.getCamp())==="ally"&&new U(t.award.getRect(),5);break;case s.TANK.ENEMY_TANK_DESTROYED:if(Tt(t)){const{tank:r,killer:a}=t;if(!r||!a)return;a.getPlayer().setKillRecord(r.getEnemyType())}break;case s.AWARD.ALLY_PICK_BOMB:case s.AWARD.ALLY_PICK_MINE:case s.AWARD.ALLY_PICK_SPADE:G(t)&&t.picker&&t.picker.getCamp()==="ally"&&t.picker.getPlayer().addScore(500);break}}}const{paddingLeft:Te,paddingTop:Ee}=o.battleField;class D extends y{constructor(){super();i(this,"rect");i(this,"type","award");i(this,"isCollision",!1);i(this,"zIndex",4);i(this,"awardType");i(this,"statusToggle",new at(o.ticker.award,[1,0],o.ticker.awardBlink,10));this.eventManager.addSubscriber(this,[s.COLLISION.ENTITY,s.AWARD.DETECT]),this.awardType=m(0,6),this.rect=D.getRandomRect(),this.eventManager.fireEvent({type:s.AWARD.CREATE})}static getRandomRect(){const e=m(0,24)*16,r=m(0,24)*16,a=[e,r,32,32];return S(a,[192,384,32,32])?this.getRandomRect():a}detectAwardRect(e){e.some(a=>S(this.rect,a.getRect()))&&(this.rect=D.getRandomRect(),this.detectAwardRect(e))}destroy(e){this.isDestroyed||(this.isDestroyed=!0,e&&this.eventManager.fireEvent({type:s.AWARD.PICKED,award:this,picker:e}),this.eventManager.fireEvent({type:s.AWARD.DESTROYED,award:this,picker:e}),super.destroy())}getAwardType(){return this.awardType}update(){this.statusToggle.update(),this.statusToggle.isFinished()&&this.destroy()}draw(e){this.statusToggle.getStatus()!==0&&e.drawImage(c.Image.bonus,this.awardType*32,0,32,32,Te+this.rect[0],Ee+this.rect[1],this.rect[2],this.rect[3])}notify(e){if(e.type===s.COLLISION.ENTITY&&e.entity===this&&e.initiator instanceof _)this.destroy(e.initiator);else if(kt(e)){const r=e.entities.filter(a=>["allyTank","enemyTank"].includes(a.getEntityType()));this.detectAwardRect(r)}}}class ke{constructor(){i(this,"eventManager",s.EM);i(this,"award",null);this.eventManager.addSubscriber(this,[s.AWARD.DESTROYED,s.TANK.AWARD_TANK_HIT])}destroy(){this.award&&!this.award.getDestroyed()&&this.award.destroy(),this.award=null}create(){this.award=new D}notify(t){t.type===s.AWARD.DESTROYED?this.destroy():t.type===s.TANK.AWARD_TANK_HIT&&(this.destroy(),this.create())}}class me{constructor(){i(this,"eventManager",s.EM);i(this,"pause",!1);i(this,"active",!0);i(this,"pauseStatus",new g([1,0],o.ticker.pause));this.eventManager.addSubscriber(this,[s.KEYBOARD.PRESS]),document.addEventListener("visibilitychange",()=>{if(document.hidden){if(!this.active||this.pause)return;this.pause=!0,this.eventManager.fireEvent({type:s.GAME.PAUSE}),this.pauseStatus.refresh(),c.Audio.play("pause")}})}update(){this.active&&this.pause&&this.pauseStatus.update()}setActive(t){this.active=t}getPause(){return this.pause}draw(t){!this.pause||this.pauseStatus.getStatus()===0||(t.save(),t.font="20px prestart",t.fillStyle=o.colors.red,t.textAlign="center",t.textBaseline="middle",t.fillText("PAUSE",o.canvas.width/2,o.canvas.height/2),t.restore())}notify(t){this.active&&A(t)&&t.type===s.KEYBOARD.PRESS&&t.key===s.CONTROL.P1.START&&(this.pause=!this.pause,this.eventManager.fireEvent({type:s.GAME.PAUSE}),this.pause&&(this.pauseStatus.refresh(),c.Audio.play("pause")))}}class Se{constructor(){i(this,"eventManager",s.EM);i(this,"tickStatus",new g([0,1],45));i(this,"lastStatus",1)}update(){this.tickStatus.update();const t=this.tickStatus.getStatus();t!=this.lastStatus&&(this.eventManager.fireEvent({type:s.BRICK.RIVER_FLOW,status:this.tickStatus.getStatus()}),this.lastStatus=t)}}class be{constructor(){i(this,"eventManager",s.EM);i(this,"enemyTicker",null);i(this,"allyTicker",null);this.eventManager.addSubscriber(this,[s.AWARD.ALLY_PICK_MINE,s.AWARD.ENEMY_PICK_MINE])}update(){this.enemyTicker&&!this.enemyTicker.isFinished()&&(this.enemyTicker.update(),this.enemyTicker.isFinished()&&this.eventManager.fireEvent({type:s.MINE.ENEMY_OVER})),this.allyTicker&&!this.allyTicker.isFinished()&&(this.allyTicker.update(),this.allyTicker.isFinished()&&this.eventManager.fireEvent({type:s.MINE.ALLY_OVER}))}notify(t){t.type===s.AWARD.ALLY_PICK_MINE?this.enemyTicker=new p(300):t.type===s.AWARD.ENEMY_PICK_MINE&&(this.allyTicker=new p(300))}}const{paddingLeft:Ae,paddingTop:we}=o.battleField;class Me{constructor(t,e){i(this,"eventManager",s.EM);i(this,"winManager");i(this,"gameState");i(this,"entityContainer",new K);i(this,"pauseFactory",new me);i(this,"mineTick",new be);i(this,"riverTick",new Se);i(this,"enemyCamp",new Wt);i(this,"allyCamp");i(this,"defeat",!1);i(this,"nextWinTick",null);this.winManager=t,this.gameState=e,this.enemyCamp.setEnemies(Ft[e.getStage()]),this.allyCamp=new Dt(e.getPlayers(),e.getStage()),new ke,new pe,new J("open",!0),new fe,new le,new oe,T.buildFromMapData(L.getMap(e.getStage())),T.buildBrickWall(),T.buildBase(),this.eventManager.addSubscriber(this,[s.TANK.LAST_ENEMY_TANK_DESTROYED,s.GAME.DEFEAT,s.BASE.DESTROY,s.AWARD.ALLY_PICK_BOMB,s.AWARD.ENEMY_PICK_BOMB])}nextWin(){this.gameState.setGameOver(this.defeat),this.winManager.toSettleWin()}update(){var t,e;this.pauseFactory.update(),!this.pauseFactory.getPause()&&(this.mineTick.update(),this.riverTick.update(),this.allyCamp.update(),this.enemyCamp.update(),this.entityContainer.update(),(t=this.nextWinTick)==null||t.update(),(e=this.nextWinTick)!=null&&e.isFinished()&&this.nextWin())}draw(t){t.fillStyle=o.colors.gray,t.fillRect(0,0,o.canvas.width,o.canvas.height),t.fillStyle=o.colors.black,t.fillRect(Ae,we,o.battleField.width,o.battleField.height),this.entityContainer.draw(t),this.enemyCamp.draw(t),this.allyCamp.draw(t),this.pauseFactory.draw(t)}destroyByEntityType(t){this.entityContainer.getAllEntity().forEach(e=>{e.getEntityType()===t&&e.explosion()})}notify(t){switch(t.type){case s.BASE.DESTROY:case s.GAME.DEFEAT:case s.TANK.LAST_ENEMY_TANK_DESTROYED:this.nextWinTick||(this.defeat=t.type!==s.TANK.LAST_ENEMY_TANK_DESTROYED,this.nextWinTick=new p(o.ticker.battleOver),this.pauseFactory.setActive(!1));break;case s.AWARD.ALLY_PICK_BOMB:this.destroyByEntityType("enemyTank");break;case s.AWARD.ENEMY_PICK_BOMB:this.destroyByEntityType("allyTank");break}}}const{UP:H,DOWN:V,LEFT:z,RIGHT:X,A:Z,B:q}=s.CONTROL.P1,{paddingLeft:Re,paddingTop:Ie}=o.battleField;class Le extends Y{constructor(){super();i(this,"type","cursor");i(this,"rect",[0,0,32,32]);i(this,"isCollision",!1);i(this,"speed",32);i(this,"moveFrequency",8);i(this,"currentBrickIndex",0);i(this,"buildSpace",!1);i(this,"moved",!1);i(this,"blinkTicker",new g([0,1],o.ticker.cursorBlink));this.zIndex=4,this.eventManager.addSubscriber(this,[s.KEYBOARD.PRESS,s.KEYBOARD.RELEASE])}buildBrick(){this.eventManager.fireEvent({type:s.CONSTRUCT.BUILD,index:this.currentBrickIndex})}buildNextBrick(){this.buildSpace=!0,this.moved?this.moved=!1:this.currentBrickIndex++,this.currentBrickIndex===14&&(this.currentBrickIndex=0),this.buildBrick()}buildPreBrick(){this.buildSpace=!0,this.moved?this.moved=!1:this.currentBrickIndex--,this.currentBrickIndex<0&&(this.currentBrickIndex=13),this.buildBrick()}keyPress(e){switch(e){case H:this.setDirection(0),this.setStop(!1);break;case X:this.setDirection(1),this.setStop(!1);break;case V:this.setDirection(2),this.setStop(!1);break;case z:this.setDirection(3),this.setStop(!1);break;case Z:this.buildPreBrick();break;case q:this.buildNextBrick();break}}keyRelease(e){switch(e){case H:case X:case z:case V:this.setStop(!0);break;case Z:case q:this.buildSpace=!1;break}}update(){this.blinkTicker.update(),super.update()}postMove(){this.blinkTicker.refresh(),this.moved=!0,this.buildSpace&&this.buildBrick()}draw(e){if(this.blinkTicker.getStatus()==1)return;const[r,a,h,l]=this.rect;e.drawImage(c.Image.myTank,0,0,32,32,r+Re,a+Ie,h,l)}notify(e){super.notify(e),A(e)&&(e.type==="KEY_PRESS"?this.keyPress(e.key):e.type==="KEY_RELEASE"&&this.keyRelease(e.key))}}const{paddingLeft:De,paddingTop:Ne}=o.battleField;class Oe{constructor(t){i(this,"eventManager",s.EM);i(this,"winManager");i(this,"entityContainer",new K);i(this,"constructionCursor",new Le);this.winManager=t,this.eventManager.addSubscriber(this,[s.CONSTRUCT.BUILD,s.KEYBOARD.PRESS]);const e=L.getCustomMap();e?T.buildFromMapData(e):T.buildFromMapData(L.getTemplateMap())}serializeMapData(){const t=[];for(let e=0;e<13;e++)t[e]=new Array(13).fill(0,0,13);this.entityContainer.getAllEntity().forEach(e=>{if(e.getEntityType()!=="cursor"){const[r,a]=e.getRect(),h=r/32|0,l=a/32|0,d=e.getBrickIndex()||0;t[l][h]=d}}),L.setCustomMap(t)}nextWin(){this.serializeMapData(),this.winManager.toMenuWin()}removeByCursorRect(){const t=this.constructionCursor.getRect(),e=this.entityContainer.getAllEntity();for(let r=0;r<e.length;r++){const a=e[r];if(a.getEntityType()==="cursor")continue;const h=a.getRect();S(t,h)&&this.entityContainer.removeEntity(a)}}buildBrick(t){this.removeByCursorRect(),T.newBrick(t,this.constructionCursor.getRect())}update(){this.entityContainer.update()}draw(t){t.fillStyle=o.colors.gray,t.fillRect(0,0,o.canvas.width,o.canvas.height),t.fillStyle=o.colors.black,t.fillRect(De,Ne,o.battleField.width,o.battleField.height),this.entityContainer.draw(t)}notify(t){t.type===s.CONSTRUCT.BUILD?this.buildBrick(t.index):A(t)&&t.type===s.KEYBOARD.PRESS&&t.key===s.CONTROL.P1.START&&this.nextWin()}}class Ce{constructor(t){i(this,"winManager");i(this,"eventManager",s.EM);i(this,"banControlTicker",new p(180));i(this,"autoJumpTicker",new p(300));i(this,"destroyed",!1);c.Audio.play("over"),this.winManager=t,this.eventManager.addSubscriber(this,[s.KEYBOARD.PRESS])}update(){this.banControlTicker.update(),this.autoJumpTicker.update(),this.autoJumpTicker.isFinished()&&this.nextWin()}nextWin(){this.destroyed=!0,this.winManager.toMenuWin()}draw(t){this.destroyed||(t.fillStyle=o.colors.black,t.fillRect(0,0,o.canvas.width,o.canvas.height),t.drawImage(c.Image.UI,0,160,248,160,132,148,248,160))}notify(t){this.banControlTicker.isFinished()&&A(t)&&this.nextWin()}}const{UP:Pe,DOWN:ve,SELECT:Ye}=s.CONTROL.P1;class _e extends y{constructor(){super();i(this,"isCollision",!1);i(this,"type","allyTank");i(this,"rect",[0,0,32,32]);i(this,"scrollY",0);i(this,"trackStatus",new g([0,1],o.ticker.trackStatusFast));i(this,"cursorTicker",null);i(this,"menuIndex",0);i(this,"menuItems",["1 PLAYER","2 PLAYERS","CONSTRUCTION"]);this.eventManager.addSubscriber(this,[s.KEYBOARD.PRESS])}preMenuItem(){c.Audio.play("hit"),this.menuIndex=this.menuIndex-1>=0?this.menuIndex-1:this.menuItems.length-1}nextMenuItem(){c.Audio.play("hit"),this.menuIndex=this.menuIndex+1>=this.menuItems.length?0:this.menuIndex+1}getMenuIndex(){return this.menuIndex}setScrollY(e){this.scrollY=e}update(){var e;this.trackStatus.update(),(e=this.cursorTicker)==null||e.update()}draw(e){const[,,r,a]=this.rect;this.menuItems.forEach((h,l)=>e.fillText(h,178,this.scrollY+270+32*l)),this.scrollY===0&&e.drawImage(c.Image.myTank,0,64+this.trackStatus.getStatus()*32,32,32,128,247+this.menuIndex*32,r,a)}notify(e){if(!(this.cursorTicker&&!this.cursorTicker.isFinished()||this.scrollY!==0))switch(this.cursorTicker=new p(o.ticker.cursorMove),e.key){case Pe:this.preMenuItem();break;case ve:case Ye:this.nextMenuItem();break}}}class Ke{constructor(t){i(this,"eventManager",s.EM);i(this,"winManager");i(this,"status","slide");i(this,"scrollY",o.canvas.height);i(this,"speed",5);i(this,"MenuCursor",new _e);this.winManager=t,this.eventManager.addSubscriber(this,[s.KEYBOARD.PRESS]),document.addEventListener("touchend",()=>c.Audio.play("count"),{once:!0}),document.body.classList.remove("gaming")}updateScrollY(){this.scrollY-=this.speed,this.MenuCursor.setScrollY(this.scrollY),this.scrollY<=0&&(this.scrollY=0,this.status="select",this.MenuCursor.setScrollY(0))}nextWin(){switch(document.body.classList.add("gaming"),this.MenuCursor.getMenuIndex()){case 0:this.winManager.setGameMode("single"),this.winManager.toStageWin();break;case 1:this.winManager.setGameMode("double"),this.winManager.toStageWin();break;case 2:this.winManager.toConstructWin();break}}update(){this.status==="slide"&&this.updateScrollY(),this.MenuCursor.update()}draw(t){t.save(),t.font="16px prestart",t.fillStyle=o.colors.black,t.fillRect(0,0,o.canvas.width,o.canvas.height),t.fillStyle=o.colors.white_100,t.drawImage(c.Image.UI,0,0,376,136,68,this.scrollY+80,376,136),t.fillText("© 2022 PRESENT",146,this.scrollY+400),t.fillText("ALL RIGHTS RESERVED",106,this.scrollY+425),this.MenuCursor.draw(t),t.fillStyle=o.colors.red,t.fillText("HEC9257",202,this.scrollY+375),t.restore()}notify(t){if(this.status==="slide"&&Object.values(s.CONTROL.P1).includes(t.key)){this.status="select",this.scrollY=0,this.MenuCursor.setScrollY(0);return}(t.key===s.CONTROL.P1.A||t.key===s.CONTROL.P1.B||t.key===s.CONTROL.P1.START)&&this.nextWin()}}class I{constructor(t,e,r,a){i(this,"enemyType",0);i(this,"finished",!1);i(this,"showPoint",!1);i(this,"currentNum",0);i(this,"killNum1");i(this,"killNum2");i(this,"maxKillNum");i(this,"top");i(this,"ticker");this.top=e+8,this.enemyType=t,this.killNum1=r.getKillRecord()[t],this.killNum2=a==null?void 0:a.getKillRecord()[t],this.maxKillNum=a===void 0?this.killNum1:Math.max(this.killNum1,this.killNum2)}isFinished(){return this.finished}setShow(t){this.showPoint=t}getShow(){return this.showPoint}update(){this.finished||(!this.ticker||this.ticker.isFinished()?this.currentNum<this.maxKillNum?(this.currentNum++,c.Audio.play("count"),this.ticker=new p(10)):this.finished=!0:this.ticker.update())}draw(t){if(t.save(),t.fillStyle=o.colors.white,t.textAlign="right",t.font="16px prestart",t.textBaseline="top",t.fillText("PTS",172,this.top),t.drawImage(c.Image.tool,96,0,16,16,222,this.top,16,16),t.drawImage(c.Image.enemyTank,this.enemyType*64,0,32,32,245,this.top-8,32,32),this.showPoint){const e=Math.min(this.killNum1,this.currentNum);t.fillText(String((this.enemyType+1)*100*e),110,this.top),t.fillText(String(e),220,this.top)}if(this.killNum2!==void 0&&(t.textAlign="left",t.drawImage(c.Image.tool,114,0,16,16,280,this.top,16,16),t.fillText("PTS",360,this.top),this.showPoint)){const e=Math.min(this.killNum2,this.currentNum);t.fillText(String(e),300,this.top),t.fillText(String((this.enemyType+1)*100*e),422,this.top)}t.restore()}}class xe{constructor(){i(this,"taskList",[])}addTask(t){this.taskList.push(t)}removeTask(t){for(let e=0;e<this.taskList.length;e++)if(this.taskList[e]===t){this.taskList.splice(e,1);break}}update(){var t,e;if(this.taskList.length!==0){if(this.taskList[0].update){this.taskList[0].update(),(e=(t=this.taskList[0]).isFinished)!=null&&e.call(t)&&this.taskList.shift();return}if(this.taskList[0].execute){this.taskList[0].execute(),this.taskList.shift();return}}}}class b{constructor(t=0){i(this,"tick",0);i(this,"count",0);i(this,"finish",!1);this.count=t}update(){this.tick++,this.tick>this.count&&(this.finish=!0)}isFinished(){return this.finish}}class Be{constructor(t,e){i(this,"winManager");i(this,"state");i(this,"tasks",new xe);i(this,"scorePoint1");i(this,"scorePoint2");i(this,"scorePoint3");i(this,"scorePoint4");i(this,"showTotal",!1);const r=this,[a,h]=e.getPlayers();this.winManager=t,this.state=e,this.scorePoint1=new I(0,184,a,h),this.scorePoint2=new I(1,224,a,h),this.scorePoint3=new I(2,264,a,h),this.scorePoint4=new I(3,304,a,h),this.tasks.addTask(new b(30)),[this.scorePoint1,this.scorePoint2,this.scorePoint3,this.scorePoint4].forEach(l=>{this.tasks.addTask({update(){l.setShow(!0),l.update(),l.isFinished()&&r.tasks.removeTask(this)}}),this.tasks.addTask(new b(30))}),this.tasks.addTask({execute(){r.showTotal=!0}}),this.tasks.addTask(new b(15)),this.tasks.addTask({execute(){r.state.getMode()!=="single"&&(a.getTotalKill()>h.getTotalKill()?(c.Audio.play("misc"),a.addScore(1e3)):a.getTotalKill()<h.getTotalKill()&&(c.Audio.play("misc"),h.addScore(1e3)))}}),this.tasks.addTask(new b(30)),this.state.getGameOver()||this.tasks.addTask({execute(){c.Audio.play("start")}}),this.tasks.addTask(new b(90)),this.tasks.addTask({execute:()=>this.nextWindow()})}nextWindow(){this.state.getGameOver()?this.winManager.toOverWin():(this.state.nextStage(),this.winManager.toBattleWin())}update(){this.tasks.update()}draw(t){t.save(),t.fillStyle=o.colors.black,t.fillRect(0,0,o.canvas.width,o.canvas.height),t.textBaseline="top",t.textAlign="left",t.font="16px prestart",t.fillStyle=o.colors.brick_red,t.fillText("HI-SCORE",100,37),t.textAlign="right",t.fillStyle=o.colors.yellow,t.fillText("20000",374,37),t.textAlign="right",t.fillText(this.state.getPlayers()[0].getScore().toString(),174,148),this.state.getMode()==="double"&&t.fillText(this.state.getPlayers()[1].getScore().toString(),423,148),t.fillStyle=o.colors.white,t.textAlign="left",t.fillText("STAGE",189,78),t.textAlign="right",t.fillText(this.state.getStage().toString(),325,78),t.fillStyle=o.colors.brick_red,t.textAlign="left",t.fillText("1-PLAYER",44,116),this.state.getMode()==="double"&&t.fillText("2-PLATER",360,116),t.strokeStyle=o.colors.white,t.lineWidth=5,t.beginPath(),t.moveTo(173,347),t.lineTo(341,347),t.stroke(),this.scorePoint1.draw(t),this.scorePoint2.draw(t),this.scorePoint3.draw(t),this.scorePoint4.draw(t),t.fillStyle=o.colors.white,t.fillText("TOTAL",83,365),t.textAlign="right",this.showTotal&&t.fillText(this.state.getPlayers()[0].getTotalKill().toString(),220,365),this.state.getMode()==="double"&&(t.textAlign="left",t.fillText("TOTAL",358,365),this.showTotal&&t.fillText(this.state.getPlayers()[1].getTotalKill().toString(),300,365)),t.restore()}}const{UP:We,DOWN:Fe,A:$e,B:Ge,START:Ue}=s.CONTROL.P1;class He{constructor(t){i(this,"eventManager",s.EM);i(this,"winManager");i(this,"stage",1);i(this,"minStage",1);i(this,"maxStage",50);i(this,"entityContainer",new K);i(this,"startDelayTicker",null);this.winManager=t,this.eventManager.addSubscriber(this,[s.KEYBOARD.PRESS]),new J("close",!0)}nextWin(){this.startDelayTicker||(c.Audio.play("start"),this.startDelayTicker=new p(o.ticker.startDelay,()=>{this.winManager.setStage(this.stage),this.winManager.toBattleWin()}))}nextStage(){++this.stage>this.maxStage&&(this.stage=this.maxStage)}preStage(){--this.stage<this.minStage&&(this.stage=this.minStage)}update(){var t;this.entityContainer.update(),(t=this.startDelayTicker)==null||t.update()}draw(t){this.entityContainer.getAllEntity().length>0?this.entityContainer.draw(t):(t.fillStyle=o.colors.gray,t.fillRect(0,0,o.canvas.width,o.canvas.height),t.fillStyle=o.colors.black,t.font="16px prestart",t.fillText(`STAGE  ${this.stage}`,190,228))}notify(t){if(!(this.entityContainer.getAllEntity().length>0||this.startDelayTicker))switch(t.key){case We:this.nextStage();break;case Fe:this.preStage();break;case $e:case Ge:case Ue:this.nextWin();break}}}class Xe{constructor(){i(this,"eventManager",s.EM);i(this,"gameWin");i(this,"ctx");i(this,"state",new ct);const[,t]=j(o.canvas.width,o.canvas.height,o.canvas.id);this.ctx=t,this.toMenuWin()}setStage(t){this.state.setStage(t)}getStage(){return this.state.getStage()}setGameMode(t){this.state.setMode(t)}getGameMode(){return this.state.getMode()}toBattleWin(){this.eventManager.removeAllSubscribers(),this.gameWin=new Me(this,this.state),console.debug(this.gameWin)}toConstructWin(){this.eventManager.removeAllSubscribers(),this.gameWin=new Oe(this)}toOverWin(){this.eventManager.removeAllSubscribers(),this.gameWin=new Ce(this)}toMenuWin(){this.eventManager.removeAllSubscribers(),this.gameWin=new Ke(this)}toSettleWin(){this.eventManager.removeAllSubscribers(),this.gameWin=new Be(this,this.state)}toStageWin(){this.eventManager.removeAllSubscribers(),this.gameWin=new He(this)}update(){this.gameWin.update()}draw(){this.gameWin.draw(this.ctx)}}export{Xe as default};
