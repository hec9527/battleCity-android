var ne=Object.defineProperty;var oe=(t,e,n)=>e in t?ne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var f=(t,e,n)=>(oe(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();const re="modulepreload",se=function(t,e){return new URL(t,e).href},M={},ie=function(e,n,o){let r=Promise.resolve();if(n&&n.length>0){const s=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),d=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));r=Promise.all(n.map(l=>{if(l=se(l,o),l in M)return;M[l]=!0;const E=l.endsWith(".css"),g=E?'[rel="stylesheet"]':"";if(!!o)for(let L=s.length-1;L>=0;L--){const y=s[L];if(y.href===l&&(!E||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${g}`))return;const u=document.createElement("link");if(u.rel=E?"stylesheet":re,E||(u.as="script",u.crossOrigin=""),u.href=l,d&&u.setAttribute("nonce",d),document.head.appendChild(u),E)return new Promise((L,y)=>{u.addEventListener("load",L),u.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${l}`)))})}))}return r.then(()=>e()).catch(s=>{const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=s,window.dispatchEvent(i),!i.defaultPrevented)throw s})},ae=`
____          _    _    _         ____  _  _          
| __ )   __ _ | |_ | |_ | |  ___  / ___|(_)| |_  _   _ 
|  _ \\  / _\` || __|| __|| | / _ \\| |    | || __|| | | |
| |_) || (_| || |_ | |_ | ||  __/| |___ | || |_ | |_| |
|____/  \\__,_| \\__| \\__||_| \\___| \\____||_| \\__| \\__, |
                                                 |___/ `,m={debug(t,...e){console.debug(`%c debug: ${t}`,"color:#58C9B9",...e)},info(t,...e){console.info(`%c info: ${t}`,"color:#30A9DE",...e)},warn(t,...e){console.warn(`%c warn: ${t}`,"color:#f9c00c",...e)},error(t,...e){console.error(`%c error: ${t}`,"color:#E53A40",...e)},copyright(){console.log(`%c ${ae} 

%c Copyright © 2022 
%c Powered By Hec9527`,"color: #abf; padding 24px 36px;","color: #f78; padding-left: 250px","color: #78f; ")}},ce={game:{minStage:1,maxStage:256},resource:{audios:["attack","bomb","count","eat","explosion","hit","life","misc","move","over","pause","start"],images:["bonus","brick","enemyTank","explode","myTank","tool","UI"]},canvas:{width:516,height:456,id:"game"},battleField:{width:416,height:416,paddingTop:20,paddingLeft:35},ticker:{defeat:30,startDelay:60,cursorMove:3,cursorBlink:15,enemyShoot:40,allyShot:15,mine:600,trackStatus:15,trackStatusFast:3,birth:70,birthStatus:5,protector:120,protectorShort:40,protectorStatus:5,pause:20,award:600,awardBlink:15,score:15,explodeBase:27,explodeBullet:10,explodeStatus:3,battleOver:200,wallBuildKeep:600,wallBlink:300,wallBlinkStatus:30},speed:{ally:1.4,enemySlow:1,enemyNormal:1.2,enemyFast:1.8,bullet:4,bulletEnhance:7.5},colors:{black:"#000",gray:"#d3d3d3",red:"#a73b2a",red1:"#ce393b",yellow:"#dfa041",brick_red:"#a73b2a",white:"#ffffff",white_100:"#f5f5f5"},explosion:{bullet:[0,1,2,1],base:[0,1,2,3,4,2]},entity:{createAllyInterval:50,createEnemyInterval:80,maxEnemyAlive:5},base:[12*32,6*32]},F={...ce},le=F.resource.images;async function de(){const t={},e=n=>new Promise((o,r)=>{const s=new Image;s.onerror=r,s.onload=()=>{o(),t[n]=s},s.src=`img/${n}.png`});return Promise.all(le.map(e)).then(()=>(m.info("图片加载完成",t),t))}const ue=F.resource.audios,A=new(window.AudioContext||window.webkitAudioContext),C=A.createGain();C.gain.value=0;class _e{constructor(){f(this,"sounds",{});f(this,"playing",new Set)}setSound(e,n){this.sounds[e]=n}play(e){if(this.playing.has(e))return;this.playing.add(e);const n=A.createBufferSource();n.buffer=this.sounds[e],n.connect(C).connect(A.destination),n.start(0),n.onended=()=>{C.gain.value=1,this.playing.delete(e)}}}function Ee(){const t=new _e,e=n=>fetch(`audio/${n}.wav`).then(o=>o.arrayBuffer()).then(o=>A.decodeAudioData(o)).then(o=>t.setSound(n,o));return new Promise(n=>{Promise.all(ue.map(e)).then(()=>m.info("音频资源加载完毕",t)).catch(o=>{m.error(`音频资源加载出错，${o}`),alert("音频加载出错")}).finally(()=>n(t))})}let K=!1;const O={Image:{},Audio:{}};function fe(){return K?Promise.resolve(O):new Promise((t,e)=>{Promise.all([Ee(),de()]).then(([n,o])=>{K=!0,O.Image=o,O.Audio=n,t(O)},e)})}function he(t,e){for(let n=0;n<t.length;n++)if(t[n]===e){t.splice(n,1);return}}function c(t){return/^#/.test(t)?document.getElementById(t.substring(1)):(/^\./.test(t),document.querySelectorAll(t))}function Je(t,e,n){const o=n?document.getElementById(n):document.createElement("canvas"),r=o.getContext("2d");return o.width=t,o.height=e,[o,r]}function Qe(t,e){const[n,o,r,s]=t,[i,d,l,E]=e,g=n-i,R=o-d;return-r<g&&g<l&&-s<R&&R<E}function Ze(t,e){return Math.floor(Math.random()*(e-t+1))+t}class we{constructor(){f(this,"subscribers",{})}addSubscriber(e,n){for(const o in n)this.subscribers[n[o]]||(this.subscribers[n[o]]=[]),this.subscribers[n[o]].push(e)}removeSubscriber(e){for(const n in this.subscribers)this.subscribers[n].includes(e)&&he(this.subscribers[n],e)}removeAllSubscribers(){this.subscribers={}}fireEvent(e){[...this.subscribers[e.type]||[]].forEach(n=>n.notify(e))}}const q=new we;window.em=q;const me={MOVE:"ENTITY_MOVE",CREATED:"ENTITY_CREATED",DESTROYED:"ENTITY_DESTROYED"},pe={SHOOT:"TANK_SHOOT",DESTROYED:"TANK_DESTROYED",AWARD_TANK_HIT:"AWARD_TANK_HIT",ALLY_TANK_STOP:"ALLY_TANK_STOP",ALLY_TANK_SLIDE:"ALLY_TANK_SLIDE",ALLY_TANK_DESTROYED:"ALLY_TANK_DESTROYED",ENEMY_TANK_DESTROYED:"ENEMY_TANK_DESTROYED",LAST_ENEMY_TANK_DESTROYED:"LAST_ENEMY_TANK_DESTROYED"},Le={ALLY_OVER:"ALLY_MINE_TICK_OVER",ENEMY_OVER:"ENEMY_MIN_TICK_OVER"},Te={RIVER_FLOW:"BRICK_RIVER_FLOW"},Se={ENEMY_YANK_EXPLOSION:"ENEMY_YANK_EXPLOSION"},ge={DESTROY:"BASE_DESTROY"},ye={BUILD:"CONSTRUCT_BUILD"},Oe={CREATE:"BULLET_CREATE",DESTROYED:"BULLET_DESTROYED"},Ae={CREATE:"AWARD_CREATE",PICKED:"AWARD_PICKED",DETECT:"AWARD_DETECT",DESTROYED:"AWARD_DESTROYED",ENEMY_PICK_SPADE:"ENEMY_PICK_SPADE",ENEMY_PICK_BOMB:"ENEMY_PICK_BOMB",ENEMY_PICK_MINE:"ENEMY_PICK_MINE",ALLY_PICK_SPADE:"ALLY_PICK_SPADE",ALLY_PICK_BOMB:"ALLY_PICK_BOMB",ALLY_PICK_MINE:"ALLY_PICK_MINE"},De={BORDER:"COLLISION_BORDER",ENTITY:"COLLISION_ENTITY"},Re={PRESS:"KEY_PRESS",RELEASE:"KEY_RELEASE"},Ie={P1:{UP:"P1_UP",RIGHT:"P1_RIGHT",DOWN:"P1_DOWN",LEFT:"P1_LEFT",A:"P1_A",B:"P1_B",SELECT:"P1_SELECT",START:"P1_START"},P2:{UP:"P2_UP",RIGHT:"P2_RIGHT",DOWN:"P2_DOWN",LEFT:"P2_LEFT",A:"P2_A",B:"P2_B"}},Pe={PAUSE:"GAME_PAUSE",OVER:"GAME_OVER",DEFEAT:"GAME_DEFEAT"},a={EM:q,BASE:ge,MINE:Le,BRICK:Te,KEYBOARD:Re,EXPLOSION:Se,AWARD:Ae,CONSTRUCT:ye,ENTITY:me,TANK:pe,BULLET:Oe,COLLISION:De,CONTROL:Ie,GAME:Pe},k={w:a.CONTROL.P1.UP,a:a.CONTROL.P1.LEFT,s:a.CONTROL.P1.DOWN,d:a.CONTROL.P1.RIGHT,g:a.CONTROL.P1.A,h:a.CONTROL.P1.B,v:a.CONTROL.P1.SELECT,b:a.CONTROL.P1.START,arrowup:a.CONTROL.P2.UP,arrowleft:a.CONTROL.P2.LEFT,arrowdown:a.CONTROL.P2.DOWN,arrowright:a.CONTROL.P2.RIGHT,k:a.CONTROL.P2.A,l:a.CONTROL.P2.B},Ne=["arrowup","arrowleft","arrowdown","arrowright"],x=["w","a","s","d"],U=["arrowup","arrowleft","arrowdown","arrowright"];class Ce{constructor(){f(this,"events",[]);f(this,"eventManager",a.EM);f(this,"keys",{});document.addEventListener("keydown",e=>{const n=e.key.toLocaleLowerCase();Ne.includes(n)&&e.preventDefault(),x.includes(e.key)?x.forEach(o=>{this.keys[o]&&this.release(o)}):U.includes(e.key)&&U.forEach(o=>{this.keys[o]&&this.release(o)}),this.press(n)}),document.addEventListener("keyup",e=>{const n=e.key.toLocaleLowerCase();e.preventDefault(),this.keys[n]&&this.release(n)})}press(e){console.debug("press key:",e),this.keys[e]=!0,this.events.push({type:"KEY_PRESS",key:k[e]})}release(e){console.debug("release key:",e),this.keys[e]=!1,this.events.push({type:"KEY_RELEASE",key:k[e]})}emitControl(){this.events.forEach(e=>{this.eventManager.fireEvent(e)}),this.events=[]}}const p=new Ce,be=/iphone|ipad|ipod|android|micromessenger/i.test(window.navigator.userAgent),D=c("#container"),ve=()=>{if(!be)return!1;const{width:t,height:e}=window.screen;return t>e},H=()=>{switch(window.orientation){case-90:case 90:console.debug("横屏:"+window.orientation),D.classList.add("landScape"),window.isLandScape=!0;break;case 0:case 180:D.classList.remove("landScape"),console.debug("竖屏:"+window.orientation),window.isLandScape=!1;break}},G=window.isLandScape=window.orientation==90||window.orientation==-90||ve();console.log({isLandScape:G});G&&(D.classList.contains("landScape")||D.classList.add("landScape"));window.onorientationchange=H;window.onresize=H;window.addEventListener("change",t=>{console.log(t)});const Ye=/iphone|ipad|ipod|android|micromessenger/i.test(window.navigator.userAgent),Be="tank_landScape_simulator_layout",Me="tank_vertical_simulator_layout",I=c("#game"),P=c("#control-wrap"),_=c("#control"),z=c("#rocker"),Ke=c("#menu"),ke=c("#action"),xe=c("#select"),Ue=c("#start"),We=c("#A"),Ve=c("#B"),$e=c("#C"),Fe=c("#D"),X={top:"a",right:"w",bottom:"d",left:"s"},qe={top:"w",right:"d",bottom:"s",left:"a"};let S,b=0,v=0,w=_.offsetWidth/2,h,T,j,Y=X;Ye&&(window.onload=function(){w=_.offsetWidth/2,[[xe,"v"],[Ue,"b"],[We,"g"],[Ve,"h"],[$e,"g"],[Fe,"h"]].forEach(([e,n])=>{e.addEventListener("touchend",()=>p.release(n)),e.addEventListener("touchstart",()=>p.press(n))})},document.documentElement.addEventListener("touchend",t=>{t.preventDefault()}),window.addEventListener("contextmenu",t=>{t.preventDefault()}),N(),window.addEventListener("resize",N),window.addEventListener("orientationchange",N),P.addEventListener("touchstart",He,{capture:!0}),P.addEventListener("touchmove",Ge,{passive:!1}),P.addEventListener("touchend",ze,{capture:!0}));function N(){const{isLandScape:t}=window,e=t?Be:Me;if(console.log({isLandScape:t}),S=t?Q():J(),Y=t?qe:X,t)I.setAttribute("style","unset");else{const n=window.innerWidth;I.style.height=n+"px",I.style.width=516/456*n+"px"}localStorage.setItem(e,JSON.stringify(S)),requestAnimationFrame(()=>Z(S))}function J(){const t={},e=[200,28],n=[120,120],o=window.innerWidth,r=window.innerHeight;return t.control={x:o*.15,y:r*.05,scale:1},t.menu={x:e[1]*1.5,y:(r-e[0])/2,scale:1},t.action={x:o*.15,y:r-n[1]-.1*r,scale:1},t}function Q(){const t={},e=[140,140],n=[200,28],o=[120,120],r=window.innerWidth,s=window.innerHeight;return t.control={x:.05*r,y:s-e[0]-.1*s,scale:1},t.menu={x:(r-n[0])/2,y:s-n[1]*2.5,scale:1},t.action={x:r-o[0]-.05*r,y:.75*s-o[1],scale:1},t}function Z(t){_.style.left=t.control.x+"px",_.style.top=t.control.y+"px",_.style.transform=`scale(${t.control.scale})`;const e=[_,Ke,ke],n=["control","menu","action"];e.forEach((o,r)=>{const s=t[n[r]];o.style.left=s.x+"px",o.style.top=s.y+"px",o.style.transform=`scale(${s.scale})`})}function ee(t){if(t.nodeName.toUpperCase()==="BODY")return!1;const e=t.offsetParent;return t.id==="control-wrap"||e&&ee(e)}function te(t){return Array.from(t).find(e=>ee(e.target))}function He(t){const e=te(t.touches);if(!e)return;t.target,b=e.pageX,v=e.pageY;const n=b-w,o=v-w;_.style.left=n+"px",_.style.top=o+"px",j=setInterval(()=>{T&&T!=h&&p.release(Y[T]),h&&(p.press(Y[h]),T=h)},84)}function Ge(t){t.preventDefault();let e=0,n=0;const o=te(t.touches);if(!o)return;const r=o.pageX-b,s=o.pageY-v,i=Math.sqrt(r**2+s**2);if(i>=w){const d=w/i;e=r*d,n=s*d}else{e=r,n=s;const d=Math.sqrt(w**2-e**2);Math.abs(n)>d&&(n=d*(s>0?1:-1))}z.style.transform=`translate(${e}px, ${n}px)`,Xe(r,s)}function ze(t){t.preventDefault(),z.style.transform="unset",clearInterval(j);const{isLandScape:e}=window;S=e?Q():J(),requestAnimationFrame(()=>Z(S)),["w","a","s","d"].forEach(n=>{p.release(n)}),T=void 0,h=void 0}function Xe(t,e){Math.abs(t)>Math.abs(e)?h=t>0?"right":"left":h=e>0?"bottom":"top"}var B={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const W=document.querySelector('meta[name="__BUILD_TIME"]'),V=document.querySelector('meta[name="__BUILD_VERSION"]'),$=document.querySelector("#copy-right")||null;W&&(W.content=B.BUILD_TIME||window.__BUILD_TIME__||"");V&&(V.content=B.BUILD_VERSION||window.__BUILD_VERSION__||"");$&&($.title=B.BUILD_VERSION||window.__BUILD_VERSION__||"");m.copyright();window.allowEnemyPick=!0;fe().then(()=>{m.info("资源加载完毕"),ie(()=>import("./index-BKbBXcL3.js"),[],import.meta.url).then(t=>{m.info("开始游戏循环");const e=new t.default;let n=0;function o(r){requestAnimationFrame(o),!(r-n<16)&&(n=r,p.emitControl(),e.update(),e.draw())}o(n)})});export{F as C,a as E,Ze as a,Je as g,Qe as i,O as r};
